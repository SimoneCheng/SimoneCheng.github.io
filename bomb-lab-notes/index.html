<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Bomb Lab è§£é¡Œç­†è¨˜ Â· å¯«å­—ç·´ç¿’</title><meta name="description" content="Bomb Lab è§£é¡Œç­†è¨˜ - Simone Cheng"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/dovefavicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://simonecheng.github.io/atom.xml" title="å¯«å­—ç·´ç¿’"><meta name="generator" content="Hexo 8.1.1"><link rel="alternate" href="/atom.xml" title="å¯«å­—ç·´ç¿’" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/dovefavicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="/tags/" target="_self">TAGS</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="/about/" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Bomb Lab è§£é¡Œç­†è¨˜</h1><div class="post-info">Dec 25, 2025<a class="tag-title" href="/tags/CSAPP/">#CSAPP</a><a class="tag-title" href="/tags/System-Programming/">#System Programming</a></div><aside class="toc"><div class="toc-title"><div class="text">ç›®éŒ„</div><div class="chevron-down-icon"><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"/></svg></div></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%B3-GDB-%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-text">ğŸ³ GDB å¸¸ç”¨æŒ‡ä»¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E6%8E%A7%E5%88%B6%E5%9F%B7%E8%A1%8C"><span class="toc-text">ğŸ¦€ æ§åˆ¶åŸ·è¡Œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E6%9F%A5%E7%9C%8B%E7%A8%8B%E5%BC%8F%E7%A2%BC"><span class="toc-text">ğŸ¦€ æŸ¥çœ‹ç¨‹å¼ç¢¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E6%9F%A5%E7%9C%8B%E8%B3%87%E6%96%99"><span class="toc-text">ğŸ¦€ æŸ¥çœ‹è³‡æ–™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E5%85%B6%E4%BB%96"><span class="toc-text">ğŸ¦€ å…¶ä»–</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%B3-x86-64-Assembly-%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98"><span class="toc-text">ğŸ³ x86-64 Assembly åŸºç¤çŸ¥è­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E5%B8%B8%E7%94%A8%E6%9A%AB%E5%AD%98%E5%99%A8%E8%88%87%E7%94%A8%E9%80%94"><span class="toc-text">ğŸ¦€ å¸¸ç”¨æš«å­˜å™¨èˆ‡ç”¨é€”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E6%8C%87%E4%BB%A4%E8%AA%9E%E6%B3%95%EF%BC%88AT-T-%E6%A0%BC%E5%BC%8F%EF%BC%89"><span class="toc-text">ğŸ¦€ æŒ‡ä»¤èªæ³•ï¼ˆAT&amp;T æ ¼å¼ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A8%98%E6%86%B6%E9%AB%94%E5%AD%98%E5%8F%96%E8%AA%9E%E6%B3%95"><span class="toc-text">ğŸ¦€ è¨˜æ†¶é«”å­˜å–èªæ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E6%AF%94%E8%BC%83%E5%92%8C%E8%B7%B3%E8%BA%8D%E6%8C%87%E4%BB%A4"><span class="toc-text">ğŸ¦€ æ¯”è¼ƒå’Œè·³èºæŒ‡ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%B7%E6%9A%AB%E5%AD%98%E5%99%A8%E6%98%AF%E4%BD%8D%E5%9D%80%E9%82%84%E6%98%AF%E5%80%BC"><span class="toc-text">ğŸ¦€ å¦‚ä½•åˆ¤æ–·æš«å­˜å™¨æ˜¯ä½å€é‚„æ˜¯å€¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%B3-Phase-1"><span class="toc-text">ğŸ³ Phase 1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A7%A3%E9%A1%8C%E7%AD%96%E7%95%A5"><span class="toc-text">ğŸ¦€ è§£é¡Œç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A7%A3%E6%9E%90%E6%AD%A5%E9%A9%9F"><span class="toc-text">ğŸ¦€ è§£ææ­¥é©Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%B3-Phase-2"><span class="toc-text">ğŸ³ Phase 2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A7%A3%E9%A1%8C%E7%AD%96%E7%95%A5-2"><span class="toc-text">ğŸ¦€ è§£é¡Œç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A7%A3%E6%9E%90%E6%AD%A5%E9%A9%9F-2"><span class="toc-text">ğŸ¦€ è§£ææ­¥é©Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%B3-Phase-3"><span class="toc-text">ğŸ³ Phase 3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A7%A3%E9%A1%8C%E7%AD%96%E7%95%A5-3"><span class="toc-text">ğŸ¦€ è§£é¡Œç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A7%A3%E6%9E%90%E6%AD%A5%E9%A9%9F-3"><span class="toc-text">ğŸ¦€ è§£ææ­¥é©Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%B3-Phase-4"><span class="toc-text">ğŸ³ Phase 4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A7%A3%E9%A1%8C%E7%AD%96%E7%95%A5-4"><span class="toc-text">ğŸ¦€ è§£é¡Œç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A7%A3%E6%9E%90%E6%AD%A5%E9%A9%9F-4"><span class="toc-text">ğŸ¦€ è§£ææ­¥é©Ÿ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%B3-Phase-5"><span class="toc-text">ğŸ³ Phase 5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A7%A3%E9%A1%8C%E9%82%8F%E8%BC%AF"><span class="toc-text">ğŸ¦€ è§£é¡Œé‚è¼¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E9%97%9C%E9%8D%B5%E6%8C%87%E4%BB%A4%E8%A7%A3%E6%9E%90"><span class="toc-text">ğŸ¦€ é—œéµæŒ‡ä»¤è§£æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A7%A3%E9%A1%8C%E6%AD%A5%E9%A9%9F"><span class="toc-text">ğŸ¦€ è§£é¡Œæ­¥é©Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E6%96%B0%E5%AD%B8%E5%88%B0%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-text">ğŸ¦€ æ–°å­¸åˆ°çš„æŒ‡ä»¤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%B3-Phase-6"><span class="toc-text">ğŸ³ Phase 6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A7%A3%E9%A1%8C%E9%82%8F%E8%BC%AF-2"><span class="toc-text">ğŸ¦€ è§£é¡Œé‚è¼¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E5%AE%8C%E6%95%B4-Assembly-Code-%E5%88%86%E6%9E%90"><span class="toc-text">ğŸ¦€ å®Œæ•´ Assembly Code åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E8%A7%A3%E9%A1%8C%E6%AD%A5%E9%A9%9F-2"><span class="toc-text">ğŸ¦€ è§£é¡Œæ­¥é©Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86"><span class="toc-text">ğŸ¦€ é‡è¦æ¦‚å¿µæ•´ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-GDB-%E9%99%A4%E9%8C%AF%E6%8A%80%E5%B7%A7"><span class="toc-text">ğŸ¦€ GDB é™¤éŒ¯æŠ€å·§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E6%96%B0%E5%AD%B8%E5%88%B0%E7%9A%84%E6%8C%87%E4%BB%A4-2"><span class="toc-text">ğŸ¦€ æ–°å­¸åˆ°çš„æŒ‡ä»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%A6%80-%E5%B0%8F%E7%B5%90"><span class="toc-text">ğŸ¦€ å°çµ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%90%B3-Reference"><span class="toc-text">ğŸ³ Reference</span></a></li></ol></div></aside><div class="post-content"><h2 id="ğŸ³-GDB-å¸¸ç”¨æŒ‡ä»¤">ğŸ³ GDB å¸¸ç”¨æŒ‡ä»¤</h2>
<h3 id="ğŸ¦€-æ§åˆ¶åŸ·è¡Œ">ğŸ¦€ æ§åˆ¶åŸ·è¡Œ</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">break</span> phase_1        <span class="comment"># åœ¨å‡½æ•¸è¨­ä¸­æ–·é»</span></span><br><span class="line"><span class="built_in">break</span> *0x400ee0      <span class="comment"># åœ¨ç‰¹å®šä½å€è¨­ä¸­æ–·é»</span></span><br><span class="line">run                  <span class="comment"># é–‹å§‹åŸ·è¡Œ</span></span><br><span class="line">run &lt; solution.txt   <span class="comment"># ç”¨æª”æ¡ˆè¼¸å…¥åŸ·è¡Œ</span></span><br><span class="line"><span class="built_in">continue</span> (c)         <span class="comment"># ç¹¼çºŒåŸ·è¡Œåˆ°ä¸‹å€‹ä¸­æ–·é»</span></span><br><span class="line">ni                   <span class="comment"># åŸ·è¡Œä¸€æ¢æŒ‡ä»¤ï¼ˆä¸é€²å…¥å‡½æ•¸ï¼‰</span></span><br><span class="line">si                   <span class="comment"># åŸ·è¡Œä¸€æ¢æŒ‡ä»¤ï¼ˆæœƒé€²å…¥å‡½æ•¸ï¼‰</span></span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-æŸ¥çœ‹ç¨‹å¼ç¢¼">ğŸ¦€ æŸ¥çœ‹ç¨‹å¼ç¢¼</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">disassemble          <span class="comment"># çœ‹ç•¶å‰å‡½æ•¸çš„çµ„èª</span></span><br><span class="line">disassemble phase_2  <span class="comment"># çœ‹æŒ‡å®šå‡½æ•¸çš„çµ„èª</span></span><br><span class="line">layout asm           <span class="comment"># é–‹å•Ÿçµ„èªè¦–çª—ï¼ˆè¦–è¦ºåŒ–ï¼‰</span></span><br><span class="line">layout regs          <span class="comment"># é¡¯ç¤ºæš«å­˜å™¨è¦–çª—</span></span><br><span class="line">ctrl + x, å†æŒ‰ a      <span class="comment"># é€€å‡º layout</span></span><br><span class="line">x/i <span class="variable">$rip</span>             <span class="comment"># çœ‹ç•¶å‰è¦åŸ·è¡Œçš„æŒ‡ä»¤</span></span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-æŸ¥çœ‹è³‡æ–™">ğŸ¦€ æŸ¥çœ‹è³‡æ–™</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> <span class="variable">$rax</span>               <span class="comment"># çœ‹æš«å­˜å™¨çš„å€¼ï¼ˆåé€²ä½ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>/x <span class="variable">$rax</span>             <span class="comment"># çœ‹æš«å­˜å™¨çš„å€¼ï¼ˆåå…­é€²ä½ï¼‰</span></span><br><span class="line">info registers           <span class="comment"># çœ‹æ‰€æœ‰æš«å­˜å™¨</span></span><br><span class="line">info registers rdi rsi   <span class="comment"># åªé¡¯ç¤ºç‰¹å®šæš«å­˜å™¨</span></span><br><span class="line">x/d <span class="variable">$rsp</span>                 <span class="comment"># çœ‹è¨˜æ†¶é«”å…§å®¹ï¼ˆåé€²ä½ï¼Œé è¨­ 8 bytesï¼‰</span></span><br><span class="line">x/dw <span class="variable">$rsp</span>                <span class="comment"># çœ‹è¨˜æ†¶é«”å…§å®¹ï¼ˆåé€²ä½ï¼Œ4 bytes = intï¼‰</span></span><br><span class="line">x/6d <span class="variable">$rsp</span>                <span class="comment"># çœ‹ 6 å€‹æ•¸å­—</span></span><br><span class="line">x/x <span class="variable">$rsp</span>                 <span class="comment"># çœ‹è¨˜æ†¶é«”å…§å®¹ï¼ˆåå…­é€²ä½ï¼‰</span></span><br><span class="line">x/s 0x402400             <span class="comment"># çœ‹è¨˜æ†¶é«”å…§å®¹ï¼ˆå­—ä¸²ï¼‰</span></span><br><span class="line">x/i <span class="variable">$rip</span>                 <span class="comment"># çœ‹è¨˜æ†¶é«”å…§å®¹ï¼ˆæŒ‡ä»¤ï¼‰</span></span><br><span class="line">x/8a 0x402470            <span class="comment"># çœ‹ 8 å€‹ä½å€ï¼ˆç”¨æ–¼ jump tableï¼‰</span></span><br><span class="line">backtrace                <span class="comment"># é¡¯ç¤ºå‡½æ•¸å‘¼å«å †ç–Šï¼ˆcall stackï¼‰ï¼Œçœ‹ç›®å‰åœ¨å“ªå€‹å‡½æ•¸ã€æ˜¯è¢«èª°å‘¼å«çš„</span></span><br><span class="line">bt                       <span class="comment"># é¡¯ç¤ºå‡½æ•¸å‘¼å«å †ç–Šï¼ˆcall stackï¼‰ï¼Œçœ‹ç›®å‰åœ¨å“ªå€‹å‡½æ•¸ã€æ˜¯è¢«èª°å‘¼å«çš„</span></span><br><span class="line"><span class="built_in">where</span>                    <span class="comment"># é¡¯ç¤ºå‡½æ•¸å‘¼å«å †ç–Šï¼ˆcall stackï¼‰ï¼Œçœ‹ç›®å‰åœ¨å“ªå€‹å‡½æ•¸ã€æ˜¯è¢«èª°å‘¼å«çš„</span></span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-å…¶ä»–">ğŸ¦€ å…¶ä»–</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quit (q)             <span class="comment"># é›¢é–‹ gdb</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="ğŸ³-x86-64-Assembly-åŸºç¤çŸ¥è­˜">ğŸ³ x86-64 Assembly åŸºç¤çŸ¥è­˜</h2>
<h3 id="ğŸ¦€-å¸¸ç”¨æš«å­˜å™¨èˆ‡ç”¨é€”">ğŸ¦€ å¸¸ç”¨æš«å­˜å™¨èˆ‡ç”¨é€”</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">å‡½æ•¸åƒæ•¸å‚³éï¼ˆcalling conventionï¼‰ï¼š</span><br><span class="line">%rdi  â†’  ç¬¬ 1 å€‹åƒæ•¸</span><br><span class="line">%rsi  â†’  ç¬¬ 2 å€‹åƒæ•¸</span><br><span class="line">%rdx  â†’  ç¬¬ 3 å€‹åƒæ•¸</span><br><span class="line">%rcx  â†’  ç¬¬ 4 å€‹åƒæ•¸</span><br><span class="line">%r8   â†’  ç¬¬ 5 å€‹åƒæ•¸</span><br><span class="line">%r9   â†’  ç¬¬ 6 å€‹åƒæ•¸</span><br><span class="line"></span><br><span class="line">å…¶ä»–é‡è¦æš«å­˜å™¨ï¼š</span><br><span class="line">%rax  â†’  å‡½æ•¸è¿”å›å€¼</span><br><span class="line">%rsp  â†’  stack pointerï¼ˆæŒ‡å‘ stack é ‚ç«¯ï¼‰</span><br><span class="line">%rbp  â†’  base pointerï¼ˆstack frame çš„åŸºæº–ï¼‰</span><br><span class="line">%rip  â†’  instruction pointerï¼ˆä¸‹ä¸€æ¢è¦åŸ·è¡Œçš„æŒ‡ä»¤ï¼‰</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-æŒ‡ä»¤èªæ³•ï¼ˆAT-T-æ ¼å¼ï¼‰">ğŸ¦€ æŒ‡ä»¤èªæ³•ï¼ˆAT&amp;T æ ¼å¼ï¼‰</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov    %rsp,%rsi    # æŠŠ %rsp çš„å€¼è¤‡è£½åˆ° %rsi</span><br><span class="line">                    # æ ¼å¼ï¼šmov ä¾†æº, ç›®çš„åœ°</span><br><span class="line">add    %eax,%eax    # %eax = %eax + %eaxï¼ˆä¹˜ä»¥ 2ï¼‰</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-è¨˜æ†¶é«”å­˜å–èªæ³•">ğŸ¦€ è¨˜æ†¶é«”å­˜å–èªæ³•</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(%rsp)              # å– %rsp æŒ‡å‘çš„è¨˜æ†¶é«”å…§å®¹</span><br><span class="line">0x4(%rsp)           # å– %rsp + 4 çš„è¨˜æ†¶é«”å…§å®¹</span><br><span class="line">-0x4(%rbx)          # å– %rbx - 4 çš„è¨˜æ†¶é«”å…§å®¹</span><br><span class="line">0x402470(,%rax,8)   # è¨ˆç®—ï¼š0x402470 + %rax * 8</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-æ¯”è¼ƒå’Œè·³èºæŒ‡ä»¤">ğŸ¦€ æ¯”è¼ƒå’Œè·³èºæŒ‡ä»¤</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cmp    %eax,(%rbx)  # æ¯”è¼ƒ (%rbx) å’Œ %eax</span><br><span class="line">je     åœ°å€          # jump if equalï¼ˆç›¸ç­‰å°±è·³ï¼‰</span><br><span class="line">jne    åœ°å€          # jump if not equalï¼ˆä¸ç›¸ç­‰å°±è·³ï¼‰</span><br><span class="line">jg     åœ°å€          # jump if greaterï¼ˆå¤§æ–¼å°±è·³ï¼‰</span><br><span class="line">ja     åœ°å€          # jump if aboveï¼ˆç„¡è™Ÿæ•¸å¤§æ–¼ï¼‰</span><br><span class="line">jbe    åœ°å€          # jump if below or equalï¼ˆå°æ–¼ç­‰æ–¼å°±è·³ï¼‰</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-å¦‚ä½•åˆ¤æ–·æš«å­˜å™¨æ˜¯ä½å€é‚„æ˜¯å€¼">ğŸ¦€ å¦‚ä½•åˆ¤æ–·æš«å­˜å™¨æ˜¯ä½å€é‚„æ˜¯å€¼</h3>
<ol>
<li>çœ‹æœ‰æ²’æœ‰æ‹¬è™Ÿ</li>
</ol>
<ul>
<li>æœ‰æ‹¬è™Ÿ <code>()</code> â†’ ç•¶ä½œä½å€ä½¿ç”¨</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov (%rsp),%eax    # å¾ %rsp æŒ‡å‘çš„ä½å€è®€è³‡æ–™</span><br></pre></td></tr></table></figure>
<ul>
<li>æ²’æ‹¬è™Ÿ â†’ ç›´æ¥ä½¿ç”¨å€¼</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov %rsp,%eax      # æŠŠ %rsp çš„å€¼ï¼ˆä½å€æœ¬èº«ï¼‰è¤‡è£½çµ¦ %eax</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>è§€å¯Ÿä½¿ç”¨æ¨¡å¼</li>
</ol>
<ul>
<li><code>add $0x4,%rbx</code> â€” æŒ‡æ¨™éå¢ 4 bytes â†’ %rbx æ˜¯ä½å€</li>
<li><code>add %eax,%eax</code> â€” æ•¸å€¼é‹ç®— â†’ %eax æ˜¯å€¼</li>
<li><code>lea 0x4(%rsp),%rbx</code> â€” Load Effective Address â†’ è¨ˆç®—ä½å€å­˜åˆ° %rbx</li>
</ul>
<hr>
<h2 id="ğŸ³-Phase-1">ğŸ³ Phase 1</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> phase_1</span><br><span class="line">Breakpoint 1 at 0x400ee0</span><br><span class="line">(gdb) run</span><br><span class="line">Starting program: /home/simone/WorkSpace/ISLab/CSAPP/bomb/bomb </span><br><span class="line">This GDB supports auto-downloading debuginfo from the following URLs:</span><br><span class="line">  &lt;https://debuginfod.ubuntu.com&gt;</span><br><span class="line">Enable debuginfod <span class="keyword">for</span> this session? (y or [n]) y</span><br><span class="line">Debuginfod has been enabled.</span><br><span class="line">To make this setting permanent, add <span class="string">&#x27;set debuginfod enabled on&#x27;</span> to .gdbinit.</span><br><span class="line">[Thread debugging using libthread_db enabled]</span><br><span class="line">Using host libthread_db library <span class="string">&quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;</span>.</span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line"><span class="built_in">which</span> to blow yourself up. Have a <span class="built_in">nice</span> day!</span><br><span class="line">aaa</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0000000000400ee0 <span class="keyword">in</span> phase_1 ()</span><br><span class="line">(gdb) disassemble</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> <span class="keyword">function</span> phase_1:</span><br><span class="line">=&gt; 0x0000000000400ee0 &lt;+0&gt;:    sub    <span class="variable">$0x8</span>,%rsp</span><br><span class="line">   0x0000000000400ee4 &lt;+4&gt;:    mov    <span class="variable">$0x402400</span>,%esi</span><br><span class="line">   0x0000000000400ee9 &lt;+9&gt;:    call   0x401338 &lt;strings_not_equal&gt;</span><br><span class="line">   0x0000000000400eee &lt;+14&gt;:    <span class="built_in">test</span>   %eax,%eax</span><br><span class="line">   0x0000000000400ef0 &lt;+16&gt;:    je     0x400ef7 &lt;phase_1+23&gt;</span><br><span class="line">   0x0000000000400ef2 &lt;+18&gt;:    call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400ef7 &lt;+23&gt;:    add    <span class="variable">$0x8</span>,%rsp</span><br><span class="line">   0x0000000000400efb &lt;+27&gt;:    ret</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-è§£é¡Œç­–ç•¥">ğŸ¦€ è§£é¡Œç­–ç•¥</h3>
<p>é€™æ˜¯æœ€ç°¡å–®çš„ phaseï¼Œä¸»è¦æ˜¯å­—ä¸²æ¯”è¼ƒã€‚</p>
<h3 id="ğŸ¦€-è§£ææ­¥é©Ÿ">ğŸ¦€ è§£ææ­¥é©Ÿ</h3>
<ol>
<li>
<p>æ‰¾é—œéµåƒæ•¸</p>
<ul>
<li>è§€å¯Ÿ <code>mov $0x402400,%esi</code> é€™è¡Œ</li>
<li><code>%esi</code> æ˜¯ç¬¬äºŒå€‹åƒæ•¸ï¼Œ<code>0x402400</code> æ˜¯ä¸€å€‹ä½å€</li>
</ul>
</li>
<li>
<p>æŸ¥çœ‹ä½å€å…§å®¹</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x402400</span><br><span class="line">0x402400: <span class="string">&quot;Border relations with Canada have never been better.&quot;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ç†è§£ç¨‹å¼é‚è¼¯
<ul>
<li>å‘¼å« <code>strings_not_equal</code> å‡½æ•¸æ¯”è¼ƒå…©å€‹å­—ä¸²</li>
<li>ç¬¬ä¸€å€‹åƒæ•¸ï¼ˆ<code>%rdi</code>ï¼‰æ˜¯ä½ çš„è¼¸å…¥</li>
<li>ç¬¬äºŒå€‹åƒæ•¸ï¼ˆ<code>%rsi</code>ï¼‰æ˜¯ <code>0x402400</code> çš„å­—ä¸²</li>
<li>å¦‚æœ <code>%eax == 0</code>ï¼ˆç›¸ç­‰ï¼‰ï¼Œå°±é€šé</li>
<li>å¦å‰‡çˆ†ç‚¸</li>
</ul>
</li>
</ol>
<h2 id="ğŸ³-Phase-2">ğŸ³ Phase 2</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> phase_2</span><br><span class="line">Breakpoint 1 at 0x400efc</span><br><span class="line">(gdb) run &lt; solution.txt </span><br><span class="line">Starting program: /home/nvidia/Desktop/bomb/bomb &lt; solution.txt</span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line"><span class="built_in">which</span> to blow yourself up. Have a <span class="built_in">nice</span> day!</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0000000000400efc <span class="keyword">in</span> phase_2 ()</span><br><span class="line">(gdb) disassemble</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> <span class="keyword">function</span> phase_2:</span><br><span class="line">=&gt; 0x0000000000400efc &lt;+0&gt;:	push   %rbp</span><br><span class="line">   0x0000000000400efd &lt;+1&gt;:	push   %rbx</span><br><span class="line">   0x0000000000400efe &lt;+2&gt;:	sub    <span class="variable">$0x28</span>,%rsp</span><br><span class="line">   0x0000000000400f02 &lt;+6&gt;:	mov    %rsp,%rsi</span><br><span class="line">   0x0000000000400f05 &lt;+9&gt;:	callq  0x40145c &lt;read_six_numbers&gt;</span><br><span class="line">   0x0000000000400f0a &lt;+14&gt;:	cmpl   <span class="variable">$0x1</span>,(%rsp)</span><br><span class="line">   0x0000000000400f0e &lt;+18&gt;:	je     0x400f30 &lt;phase_2+52&gt;</span><br><span class="line">   0x0000000000400f10 &lt;+20&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400f15 &lt;+25&gt;:	jmp    0x400f30 &lt;phase_2+52&gt;</span><br><span class="line">   0x0000000000400f17 &lt;+27&gt;:	mov    -0x4(%rbx),%eax</span><br><span class="line">   0x0000000000400f1a &lt;+30&gt;:	add    %eax,%eax</span><br><span class="line">   0x0000000000400f1c &lt;+32&gt;:	cmp    %eax,(%rbx)</span><br><span class="line">   0x0000000000400f1e &lt;+34&gt;:	je     0x400f25 &lt;phase_2+41&gt;</span><br><span class="line">   0x0000000000400f20 &lt;+36&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400f25 &lt;+41&gt;:	add    <span class="variable">$0x4</span>,%rbx</span><br><span class="line">   0x0000000000400f29 &lt;+45&gt;:	cmp    %rbp,%rbx</span><br><span class="line">   0x0000000000400f2c &lt;+48&gt;:	jne    0x400f17 &lt;phase_2+27&gt;</span><br><span class="line">   0x0000000000400f2e &lt;+50&gt;:	jmp    0x400f3c &lt;phase_2+64&gt;</span><br><span class="line">   0x0000000000400f30 &lt;+52&gt;:	lea    0x4(%rsp),%rbx</span><br><span class="line">   0x0000000000400f35 &lt;+57&gt;:	lea    0x18(%rsp),%rbp</span><br><span class="line">   0x0000000000400f3a &lt;+62&gt;:	jmp    0x400f17 &lt;phase_2+27&gt;</span><br><span class="line">   0x0000000000400f3c &lt;+64&gt;:	add    <span class="variable">$0x28</span>,%rsp</span><br><span class="line">   0x0000000000400f40 &lt;+68&gt;:	pop    %rbx</span><br><span class="line">   0x0000000000400f41 &lt;+69&gt;:	pop    %rbp</span><br><span class="line">   0x0000000000400f42 &lt;+70&gt;:	retq   </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-è§£é¡Œç­–ç•¥-2">ğŸ¦€ è§£é¡Œç­–ç•¥</h3>
<p>é€™å€‹ phase æª¢æŸ¥ 6 å€‹æ•¸å­—æ˜¯å¦ç¬¦åˆç‰¹å®šè¦å¾‹ã€‚éœ€è¦ç†è§£è¿´åœˆçµæ§‹ã€‚</p>
<h3 id="ğŸ¦€-è§£ææ­¥é©Ÿ-2">ğŸ¦€ è§£ææ­¥é©Ÿ</h3>
<ol>
<li>
<p>ç†è§£è¼¸å…¥</p>
<ul>
<li>å‡½æ•¸ <code>read_six_numbers</code> æœƒè®€å– 6 å€‹æ•´æ•¸</li>
<li>é€™äº›æ•¸å­—å­˜åœ¨ stack ä¸Šï¼ˆå¾ <code>%rsp</code> é–‹å§‹ï¼Œæ¯å€‹ä½” 4 bytesï¼‰</li>
</ul>
</li>
<li>
<p>ç¬¬ä¸€å€‹æ•¸å­—çš„æª¢æŸ¥</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmpl   $0x1,(%rsp)    # æ¯”è¼ƒ (%rsp) å’Œ 1</span><br><span class="line">je     0x400f30       # ç›¸ç­‰å°±ç¹¼çºŒ</span><br></pre></td></tr></table></figure>
<p>â†’ ç¬¬ä¸€å€‹æ•¸å­—å¿…é ˆæ˜¯ 1</p>
<ol start="3">
<li>è¿´åœˆé‚è¼¯åˆ†æï¼ˆé—œéµï¼‰</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov    -0x4(%rbx),%eax    # å–å‰ä¸€å€‹æ•¸å­—</span><br><span class="line">add    %eax,%eax          # %eax = %eax + %eaxï¼ˆä¹˜ä»¥ 2ï¼ï¼‰</span><br><span class="line">cmp    %eax,(%rbx)        # æ¯”è¼ƒç•¶å‰æ•¸å­—å’Œ %eax</span><br></pre></td></tr></table></figure>
<ul>
<li><code>add %eax,%eax</code> ç­‰æ–¼æŠŠ %eax ä¹˜ä»¥ 2</li>
<li>æ¯å€‹æ•¸å­—å¿…é ˆæ˜¯å‰ä¸€å€‹æ•¸å­—çš„ <strong>2 å€</strong></li>
</ul>
<ol start="4">
<li>é©—è­‰æ¨ç†</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/6d <span class="variable">$rsp</span>      <span class="comment"># æŸ¥çœ‹è¼¸å…¥çš„ 6 å€‹æ•¸å­—</span></span><br><span class="line">(gdb) ni             <span class="comment"># å–®æ­¥åŸ·è¡Œ</span></span><br><span class="line">(gdb) <span class="built_in">print</span> <span class="variable">$eax</span>     <span class="comment"># è§€å¯Ÿè¨ˆç®—çµæœ</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>æ¨ç®—æ•¸åˆ—
<ul>
<li>ç¬¬ 1 å€‹ï¼š1</li>
<li>ç¬¬ 2 å€‹ï¼š1 Ã— 2 = 2</li>
<li>ç¬¬ 3 å€‹ï¼š2 Ã— 2 = 4</li>
<li>ç¬¬ 4 å€‹ï¼š4 Ã— 2 = 8</li>
<li>ç¬¬ 5 å€‹ï¼š8 Ã— 2 = 16</li>
<li>ç¬¬ 6 å€‹ï¼š16 Ã— 2 = 32</li>
</ul>
</li>
</ol>
<h2 id="ğŸ³-Phase-3">ğŸ³ Phase 3</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> phase_3</span><br><span class="line">Breakpoint 1 at 0x400f43</span><br><span class="line">(gdb) run solution.txt </span><br><span class="line">Starting program: /home/nvidia/Desktop/bomb/bomb solution.txt</span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line"><span class="built_in">which</span> to blow yourself up. Have a <span class="built_in">nice</span> day!</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">That<span class="string">&#x27;s number 2.  Keep going!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Breakpoint 1, 0x0000000000400f43 in phase_3 ()</span></span><br><span class="line"><span class="string">(gdb) layout asm</span></span><br><span class="line"><span class="string">(gdb) disassemble</span></span><br><span class="line"><span class="string">No frame selected.</span></span><br><span class="line"><span class="string">(gdb) run solution.txt </span></span><br><span class="line"><span class="string">Starting program: /home/nvidia/Desktop/bomb/bomb solution.txt</span></span><br><span class="line"><span class="string">Welcome to my fiendish little bomb. You have 6 phases with</span></span><br><span class="line"><span class="string">which to blow yourself up. Have a nice day!</span></span><br><span class="line"><span class="string">Phase 1 defused. How about the next one?</span></span><br><span class="line"><span class="string">That&#x27;</span>s number 2.  Keep going!</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0000000000400f43 <span class="keyword">in</span> phase_3 ()</span><br><span class="line">(gdb) disassemble</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> <span class="keyword">function</span> phase_3:</span><br><span class="line">=&gt; 0x0000000000400f43 &lt;+0&gt;:	sub    <span class="variable">$0x18</span>,%rsp</span><br><span class="line">   0x0000000000400f47 &lt;+4&gt;:	lea    0xc(%rsp),%rcx</span><br><span class="line">   0x0000000000400f4c &lt;+9&gt;:	lea    0x8(%rsp),%rdx</span><br><span class="line">   0x0000000000400f51 &lt;+14&gt;:	mov    <span class="variable">$0x4025cf</span>,%esi</span><br><span class="line">   0x0000000000400f56 &lt;+19&gt;:	mov    <span class="variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000400f5b &lt;+24&gt;:	callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x0000000000400f60 &lt;+29&gt;:	cmp    <span class="variable">$0x1</span>,%eax</span><br><span class="line">   0x0000000000400f63 &lt;+32&gt;:	jg     0x400f6a &lt;phase_3+39&gt;</span><br><span class="line">   0x0000000000400f65 &lt;+34&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400f6a &lt;+39&gt;:	cmpl   <span class="variable">$0x7</span>,0x8(%rsp)</span><br><span class="line">   0x0000000000400f6f &lt;+44&gt;:	ja     0x400fad &lt;phase_3+106&gt;</span><br><span class="line">   0x0000000000400f71 &lt;+46&gt;:	mov    0x8(%rsp),%eax</span><br><span class="line">   0x0000000000400f75 &lt;+50&gt;:	jmpq   *0x402470(,%rax,8)</span><br><span class="line">   0x0000000000400f7c &lt;+57&gt;:	mov    <span class="variable">$0xcf</span>,%eax</span><br><span class="line">   0x0000000000400f81 &lt;+62&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f83 &lt;+64&gt;:	mov    <span class="variable">$0x2c3</span>,%eax</span><br><span class="line">   0x0000000000400f88 &lt;+69&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f8a &lt;+71&gt;:	mov    <span class="variable">$0x100</span>,%eax</span><br><span class="line">   0x0000000000400f8f &lt;+76&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f91 &lt;+78&gt;:	mov    <span class="variable">$0x185</span>,%eax</span><br><span class="line">   0x0000000000400f96 &lt;+83&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f98 &lt;+85&gt;:	mov    <span class="variable">$0xce</span>,%eax</span><br><span class="line">   0x0000000000400f9d &lt;+90&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400f9f &lt;+92&gt;:	mov    <span class="variable">$0x2aa</span>,%eax</span><br><span class="line">   0x0000000000400fa4 &lt;+97&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400fa6 &lt;+99&gt;:	mov    <span class="variable">$0x147</span>,%eax</span><br><span class="line">   0x0000000000400fab &lt;+104&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400fad &lt;+106&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400fb2 &lt;+111&gt;:	mov    <span class="variable">$0x0</span>,%eax</span><br><span class="line">   0x0000000000400fb7 &lt;+116&gt;:	jmp    0x400fbe &lt;phase_3+123&gt;</span><br><span class="line">   0x0000000000400fb9 &lt;+118&gt;:	mov    <span class="variable">$0x137</span>,%eax</span><br><span class="line">   0x0000000000400fbe &lt;+123&gt;:	cmp    0xc(%rsp),%eax</span><br><span class="line">   0x0000000000400fc2 &lt;+127&gt;:	je     0x400fc9 &lt;phase_3+134&gt;</span><br><span class="line">   0x0000000000400fc4 &lt;+129&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000400fc9 &lt;+134&gt;:	add    <span class="variable">$0x18</span>,%rsp</span><br><span class="line">   0x0000000000400fcd &lt;+138&gt;:	retq   </span><br><span class="line">End of assembler dump.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-è§£é¡Œç­–ç•¥-3">ğŸ¦€ è§£é¡Œç­–ç•¥</h3>
<p>é€™å€‹ phase ä½¿ç”¨ switch-case çµæ§‹ï¼Œæ ¹æ“šç¬¬ä¸€å€‹æ•¸å­—æ±ºå®šç¬¬äºŒå€‹æ•¸å­—çš„å€¼ã€‚æœ‰ 8 çµ„å¯èƒ½çš„ç­”æ¡ˆã€‚</p>
<h3 id="ğŸ¦€-è§£ææ­¥é©Ÿ-3">ğŸ¦€ è§£ææ­¥é©Ÿ</h3>
<ol>
<li>ç†è§£è¼¸å…¥æ ¼å¼</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x4025cf</span><br><span class="line">0x4025cf: <span class="string">&quot;%d %d&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>sscanf</code> è®€å–å…©å€‹æ•´æ•¸</li>
<li>åƒæ•¸æº–å‚™ï¼š
<ul>
<li><code>%rdi</code>ï¼šè¼¸å…¥å­—ä¸²ï¼ˆä½ æ‰“çš„å…§å®¹ï¼‰</li>
<li><code>%rsi</code>ï¼šæ ¼å¼å­—ä¸² <code>&quot;%d %d&quot;</code></li>
<li><code>%rdx</code>ï¼šç¬¬ä¸€å€‹æ•´æ•¸çš„å„²å­˜ä½å€ï¼ˆ<code>%rsp+8</code>ï¼‰</li>
<li><code>%rcx</code>ï¼šç¬¬äºŒå€‹æ•´æ•¸çš„å„²å­˜ä½å€ï¼ˆ<code>%rsp+12</code>ï¼‰</li>
</ul>
</li>
</ul>
<ol start="2">
<li>ç¬¬ä¸€å€‹æ•¸å­—çš„ç¯„åœé™åˆ¶</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmpl   $0x7,0x8(%rsp)    # æ¯”è¼ƒç¬¬ä¸€å€‹æ•¸å­—å’Œ 7</span><br><span class="line">ja     0x400fad          # å¦‚æœå¤§æ–¼å°±çˆ†ç‚¸</span><br></pre></td></tr></table></figure>
<p>â†’ ç¬¬ä¸€å€‹æ•¸å­—å¿…é ˆ <code>&lt;=</code> 7ï¼ˆå³ 0-7ï¼‰</p>
<ol start="3">
<li>Jump Table çš„é‹ä½œåŸç†</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmpq   *0x402470(,%rax,8)</span><br></pre></td></tr></table></figure>
<p>é€™æ˜¯é–“æ¥è·³èºï¼Œå¯¦ç¾ switch-caseï¼š</p>
<ul>
<li><code>%rax</code> = ç¬¬ä¸€å€‹æ•¸å­—ï¼ˆ0-7ï¼‰</li>
<li>è¨ˆç®—ä½å€ï¼š<code>0x402470 + %rax * 8</code></li>
<li>å¾è©²ä½å€è®€å–è·³èºç›®æ¨™ï¼Œç„¶å¾Œè·³éå»</li>
</ul>
<ol start="4">
<li>æŸ¥çœ‹ Jump Tableï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/8a 0x402470</span><br><span class="line">0x402470:  0x400f7c     <span class="comment"># case 0</span></span><br><span class="line">0x402478:  0x400fb9     <span class="comment"># case 1</span></span><br><span class="line">0x402480:  0x400f83     <span class="comment"># case 2</span></span><br><span class="line">0x402488:  0x400f8a     <span class="comment"># case 3</span></span><br><span class="line">0x402490:  0x400f91     <span class="comment"># case 4</span></span><br><span class="line">0x402498:  0x400f98     <span class="comment"># case 5</span></span><br><span class="line">0x4024a0:  0x400f9f     <span class="comment"># case 6</span></span><br><span class="line">0x4024a8:  0x400fa6     <span class="comment"># case 7</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>å„å€‹ Case çš„çµæ§‹</li>
</ol>
<p>æ¯å€‹ case éƒ½åšä¸€æ¨£çš„äº‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov    $æŸå€‹æ•¸å­—,%eax     # æŠŠæœŸæœ›å€¼æ”¾åˆ° %eax</span><br><span class="line">jmp    0x400fbe          # è·³åˆ°å…±åŒæª¢æŸ¥é»</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>å…±åŒæª¢æŸ¥é»ï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmp    0xc(%rsp),%eax    # æ¯”è¼ƒ %eax å’Œç¬¬äºŒå€‹è¼¸å…¥ (%rsp+12)</span><br><span class="line">je     0x400fc9          # ç›¸ç­‰å°±é€šé</span><br><span class="line">callq  explode_bomb      # å¦å‰‡çˆ†ç‚¸</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>æ‰¾å‡ºå°æ‡‰é—œä¿‚</li>
</ol>
<p>å¾çµ„èªä¸­å¯ä»¥çœ‹åˆ° 8 å€‹ case çš„æœŸæœ›å€¼ï¼ˆåå…­é€²ä½ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>Case</th>
<th>çµ„èªä½ç½®</th>
<th>%eax å€¼ï¼ˆhexï¼‰</th>
<th>è½‰æˆåé€²ä½</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>+57</td>
<td>0xcf</td>
<td>207</td>
</tr>
<tr>
<td>1</td>
<td>+118</td>
<td>0x137</td>
<td>311</td>
</tr>
<tr>
<td>2</td>
<td>+64</td>
<td>0x2c3</td>
<td>707</td>
</tr>
<tr>
<td>3</td>
<td>+71</td>
<td>0x100</td>
<td>256</td>
</tr>
<tr>
<td>4</td>
<td>+78</td>
<td>0x185</td>
<td>389</td>
</tr>
<tr>
<td>5</td>
<td>+85</td>
<td>0xce</td>
<td>206</td>
</tr>
<tr>
<td>6</td>
<td>+92</td>
<td>0x2aa</td>
<td>682</td>
</tr>
<tr>
<td>7</td>
<td>+99</td>
<td>0x147</td>
<td>327</td>
</tr>
</tbody>
</table>
<h2 id="ğŸ³-Phase-4">ğŸ³ Phase 4</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> phase_4</span><br><span class="line">Breakpoint 1 at 0x40100c</span><br><span class="line">(gdb) run solution.txt</span><br><span class="line">Starting program: /home/simone/WorkSpace/ISLab/CSAPP/bomb/bomb solution.txt</span><br><span class="line"></span><br><span class="line">This GDB supports auto-downloading debuginfo from the following URLs:</span><br><span class="line">  &lt;https://debuginfod.ubuntu.com&gt;</span><br><span class="line">Enable debuginfod <span class="keyword">for</span> this session? (y or [n]) y</span><br><span class="line">Debuginfod has been enabled.</span><br><span class="line">To make this setting permanent, add <span class="string">&#x27;set debuginfod enabled on&#x27;</span> to .gdbinit.</span><br><span class="line">[Thread debugging using libthread_db enabled]</span><br><span class="line">Using host libthread_db library <span class="string">&quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;</span>.</span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line"><span class="built_in">which</span> to blow yourself up. Have a <span class="built_in">nice</span> day!</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">That<span class="string">&#x27;s number 2.  Keep going!</span></span><br><span class="line"><span class="string">Halfway there!</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Breakpoint 1, 0x000000000040100c in phase_4 ()</span></span><br><span class="line"><span class="string">(gdb) disassemble</span></span><br><span class="line"><span class="string">Dump of assembler code for function phase_4:</span></span><br><span class="line"><span class="string">=&gt; 0x000000000040100c &lt;+0&gt;:	sub    $0x18,%rsp</span></span><br><span class="line"><span class="string">   0x0000000000401010 &lt;+4&gt;:	lea    0xc(%rsp),%rcx</span></span><br><span class="line"><span class="string">   0x0000000000401015 &lt;+9&gt;:	lea    0x8(%rsp),%rdx</span></span><br><span class="line"><span class="string">   0x000000000040101a &lt;+14&gt;:	mov    $0x4025cf,%esi</span></span><br><span class="line"><span class="string">   0x000000000040101f &lt;+19&gt;:	mov    $0x0,%eax</span></span><br><span class="line"><span class="string">   0x0000000000401024 &lt;+24&gt;:	call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;</span></span><br><span class="line"><span class="string">   0x0000000000401029 &lt;+29&gt;:	cmp    $0x2,%eax</span></span><br><span class="line"><span class="string">   0x000000000040102c &lt;+32&gt;:	jne    0x401035 &lt;phase_4+41&gt;</span></span><br><span class="line"><span class="string">   0x000000000040102e &lt;+34&gt;:	cmpl   $0xe,0x8(%rsp)</span></span><br><span class="line"><span class="string">   0x0000000000401033 &lt;+39&gt;:	jbe    0x40103a &lt;phase_4+46&gt;</span></span><br><span class="line"><span class="string">   0x0000000000401035 &lt;+41&gt;:	call   0x40143a &lt;explode_bomb&gt;</span></span><br><span class="line"><span class="string">   0x000000000040103a &lt;+46&gt;:	mov    $0xe,%edx</span></span><br><span class="line"><span class="string">   0x000000000040103f &lt;+51&gt;:	mov    $0x0,%esi</span></span><br><span class="line"><span class="string">   0x0000000000401044 &lt;+56&gt;:	mov    0x8(%rsp),%edi</span></span><br><span class="line"><span class="string">   0x0000000000401048 &lt;+60&gt;:	call   0x400fce &lt;func4&gt;</span></span><br><span class="line"><span class="string">   0x000000000040104d &lt;+65&gt;:	test   %eax,%eax</span></span><br><span class="line"><span class="string">   0x000000000040104f &lt;+67&gt;:	jne    0x401058 &lt;phase_4+76&gt;</span></span><br><span class="line"><span class="string">   0x0000000000401051 &lt;+69&gt;:	cmpl   $0x0,0xc(%rsp)</span></span><br><span class="line"><span class="string">   0x0000000000401056 &lt;+74&gt;:	je     0x40105d &lt;phase_4+81&gt;</span></span><br><span class="line"><span class="string">   0x0000000000401058 &lt;+76&gt;:	call   0x40143a &lt;explode_bomb&gt;</span></span><br><span class="line"><span class="string">   0x000000000040105d &lt;+81&gt;:	add    $0x18,%rsp</span></span><br><span class="line"><span class="string">   0x0000000000401061 &lt;+85&gt;:	ret</span></span><br><span class="line"><span class="string">End of assembler dump.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(gdb) disassemble</span></span><br><span class="line"><span class="string">Dump of assembler code for function func4:</span></span><br><span class="line"><span class="string">=&gt; 0x0000000000400fce &lt;+0&gt;:	sub    $0x8,%rsp</span></span><br><span class="line"><span class="string">   0x0000000000400fd2 &lt;+4&gt;:	mov    %edx,%eax</span></span><br><span class="line"><span class="string">   0x0000000000400fd4 &lt;+6&gt;:	sub    %esi,%eax</span></span><br><span class="line"><span class="string">   0x0000000000400fd6 &lt;+8&gt;:	mov    %eax,%ecx</span></span><br><span class="line"><span class="string">   0x0000000000400fd8 &lt;+10&gt;:	shr    $0x1f,%ecx</span></span><br><span class="line"><span class="string">   0x0000000000400fdb &lt;+13&gt;:	add    %ecx,%eax</span></span><br><span class="line"><span class="string">   0x0000000000400fdd &lt;+15&gt;:	sar    $1,%eax</span></span><br><span class="line"><span class="string">   0x0000000000400fdf &lt;+17&gt;:	lea    (%rax,%rsi,1),%ecx</span></span><br><span class="line"><span class="string">   0x0000000000400fe2 &lt;+20&gt;:	cmp    %edi,%ecx</span></span><br><span class="line"><span class="string">   0x0000000000400fe4 &lt;+22&gt;:	jle    0x400ff2 &lt;func4+36&gt;</span></span><br><span class="line"><span class="string">   0x0000000000400fe6 &lt;+24&gt;:	lea    -0x1(%rcx),%edx</span></span><br><span class="line"><span class="string">   0x0000000000400fe9 &lt;+27&gt;:	call   0x400fce &lt;func4&gt;</span></span><br><span class="line"><span class="string">   0x0000000000400fee &lt;+32&gt;:	add    %eax,%eax</span></span><br><span class="line"><span class="string">   0x0000000000400ff0 &lt;+34&gt;:	jmp    0x401007 &lt;func4+57&gt;</span></span><br><span class="line"><span class="string">   0x0000000000400ff2 &lt;+36&gt;:	mov    $0x0,%eax</span></span><br><span class="line"><span class="string">   0x0000000000400ff7 &lt;+41&gt;:	cmp    %edi,%ecx</span></span><br><span class="line"><span class="string">   0x0000000000400ff9 &lt;+43&gt;:	jge    0x401007 &lt;func4+57&gt;</span></span><br><span class="line"><span class="string">   0x0000000000400ffb &lt;+45&gt;:	lea    0x1(%rcx),%esi</span></span><br><span class="line"><span class="string">   0x0000000000400ffe &lt;+48&gt;:	call   0x400fce &lt;func4&gt;</span></span><br><span class="line"><span class="string">   0x0000000000401003 &lt;+53&gt;:	lea    0x1(%rax,%rax,1),%eax</span></span><br><span class="line"><span class="string">   0x0000000000401007 &lt;+57&gt;:	add    $0x8,%rsp</span></span><br><span class="line"><span class="string">   0x000000000040100b &lt;+61&gt;:	ret</span></span><br><span class="line"><span class="string">End of assembler dump.</span></span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-è§£é¡Œç­–ç•¥-4">ğŸ¦€ è§£é¡Œç­–ç•¥</h3>
<p>é€™å€‹ phase åŒ…å«éè¿´å‡½æ•¸ <code>func4</code>ï¼Œå¯¦ä½œäºŒåˆ†æœå°‹é‚è¼¯ã€‚éœ€è¦ç†è§£éè¿´å‘¼å«å’Œè¿”å›å€¼çš„è¨ˆç®—ã€‚</p>
<h3 id="ğŸ¦€-è§£ææ­¥é©Ÿ-4">ğŸ¦€ è§£ææ­¥é©Ÿ</h3>
<ol>
<li>
<p>ç†è§£è¼¸å…¥æ ¼å¼å’Œ Phase 3 é¡ä¼¼ï¼Œä½¿ç”¨ <code>sscanf</code> è®€å–å…©å€‹æ•´æ•¸ã€‚</p>
</li>
<li>
<p>func4 çš„åƒæ•¸å¾ phase_4 å‘¼å« func4 æ™‚ï¼š</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov    0x8(%rsp),%edi     # ç¬¬ 1 åƒæ•¸ = ç¬¬ä¸€å€‹è¼¸å…¥</span><br><span class="line">mov    $0x0,%esi          # ç¬¬ 2 åƒæ•¸ = 0</span><br><span class="line">mov    $0xe,%edx          # ç¬¬ 3 åƒæ•¸ = 14</span><br><span class="line">call   func4</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>func4 çš„é‚è¼¯çµæ§‹è¨ˆç®—ä¸­é»ï¼ˆBinary Search çš„æ ¸å¿ƒï¼‰ï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mov    %edx,%eax          # %eax = high (14)</span><br><span class="line">sub    %esi,%eax          # %eax = high - low</span><br><span class="line">mov    %eax,%ecx</span><br><span class="line">shr    $0x1f,%ecx         # è™•ç†ç¬¦è™Ÿä½ï¼ˆé€™è£¡æ˜¯ 0ï¼‰</span><br><span class="line">add    %ecx,%eax</span><br><span class="line">sar    $1,%eax            # é™¤ä»¥ 2</span><br><span class="line">lea    (%rax,%rsi,1),%ecx # %ecx = mid = (low + high) / 2</span><br></pre></td></tr></table></figure>
<p>é€™æ®µè¨ˆç®—ï¼š<code>mid = (low + high) / 2</code></p>
<p>ä¸‰è·¯åˆ†æ”¯åˆ¤æ–·ï¼šåˆ†æ”¯ 1ï¼šmid &gt; targetï¼ˆæœå°‹å·¦åŠé‚Šï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cmp    %edi,%ecx          # æ¯”è¼ƒ mid å’Œ target</span><br><span class="line">jle    0x400ff2           # å¦‚æœ mid &lt;= targetï¼Œè·³åˆ°åˆ†æ”¯ 2</span><br><span class="line">lea    -0x1(%rcx),%edx    # high = mid - 1</span><br><span class="line">call   func4              # éè¿´ï¼šfunc4(target, low, mid-1)</span><br><span class="line">add    %eax,%eax          # è¿”å›å€¼ *= 2</span><br><span class="line">jmp    0x401007           # è¿”å›</span><br></pre></td></tr></table></figure>
<p>åˆ†æ”¯ 2ï¼šmid == targetï¼ˆæ‰¾åˆ°ç›®æ¨™ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov    $0x0,%eax          # è¿”å›å€¼ = 0</span><br><span class="line">cmp    %edi,%ecx          # æ¯”è¼ƒ mid å’Œ target</span><br><span class="line">jge    0x401007           # å¦‚æœ mid &gt;= targetï¼Œè¿”å›</span><br></pre></td></tr></table></figure>
<p>åˆ†æ”¯ 3ï¼šmid &lt; targetï¼ˆæœå°‹å³åŠé‚Šï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lea    0x1(%rcx),%esi     # low = mid + 1</span><br><span class="line">call   func4              # éè¿´ï¼šfunc4(target, mid+1, high)</span><br><span class="line">lea    0x1(%rax,%rax,1),%eax  # è¿”å›å€¼ = è¿”å›å€¼ * 2 + 1</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>è¿½è¹¤éè¿´éç¨‹ä½¿ç”¨ <code>si</code> é€²å…¥éè¿´ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> func4</span><br><span class="line">(gdb) run</span><br><span class="line"><span class="comment"># è¼¸å…¥å‰é¢çš„ç­”æ¡ˆ...</span></span><br><span class="line">1 0    <span class="comment"># æ¸¬è©¦ç­”æ¡ˆ</span></span><br><span class="line"></span><br><span class="line">(gdb) si              <span class="comment"># ç”¨ si è€Œä¸æ˜¯ niï¼</span></span><br><span class="line">(gdb) backtrace       <span class="comment"># æŸ¥çœ‹éè¿´æ·±åº¦</span></span><br><span class="line">(gdb) info registers  <span class="comment"># æŸ¥çœ‹åƒæ•¸è®ŠåŒ–</span></span><br></pre></td></tr></table></figure>
<p>è‡ªå‹•è¿½è¹¤éè¿´å‘¼å«ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> func4</span><br><span class="line">(gdb) commands</span><br><span class="line">&gt; silent</span><br><span class="line">&gt; <span class="built_in">printf</span> <span class="string">&quot;func4(%d, %d, %d), mid=%d\n&quot;</span>, <span class="variable">$edi</span>, <span class="variable">$esi</span>, <span class="variable">$edx</span>, (<span class="variable">$esi</span>+<span class="variable">$edx</span>)/2</span><br><span class="line">&gt; <span class="built_in">continue</span></span><br><span class="line">&gt; end</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>æ¨å°æœ‰æ•ˆç­”æ¡ˆé—œéµè§€å¯Ÿï¼š åªæœ‰ç•¶è¼¸å…¥ç­‰æ–¼æŸæ¬¡è¨ˆç®—çš„ mid å€¼æ™‚ï¼Œæ‰æœƒèµ°åˆ†æ”¯ 2ï¼Œè¿”å› 0ã€‚</li>
</ol>
<p>åˆå§‹å‘¼å«ï¼š<code>func4(target, 0, 14)</code></p>
<p>å¯èƒ½çš„ mid å€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ 1 å±¤ï¼šmid = (0 + 14) / 2 = 7</span><br><span class="line">ç¬¬ 2 å±¤ï¼šmid = (0 + 6) / 2 = 3  æˆ–  mid = (8 + 14) / 2 = 11</span><br><span class="line">ç¬¬ 3 å±¤ï¼šmid = (0 + 2) / 2 = 1  æˆ–  mid = (4 + 6) / 2 = 5</span><br><span class="line">ç¬¬ 4 å±¤ï¼šmid = (0 + 0) / 2 = 0  æˆ–  mid = (2 + 2) / 2 = 2</span><br></pre></td></tr></table></figure>
<p>ä½†åªæœ‰åœ¨ã€Œè‡ªç„¶åˆ†è£‚ã€è·¯å¾‘ä¸Šçš„ mid æœƒè¿”å› 0ï¼š</p>
<p>å¾ 14 é–‹å§‹ä¸æ–·é™¤ä»¥ 2ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">14 / 2 = 7</span><br><span class="line">7 / 2 = 3</span><br><span class="line">3 / 2 = 1</span><br><span class="line">1 / 2 = 0</span><br></pre></td></tr></table></figure>
<p>â†’ ç¬¬ä¸€å€‹è¼¸å…¥åªèƒ½æ˜¯ï¼š0, 1, 3, 7</p>
<ol start="6">
<li>é©—è­‰ç­”æ¡ˆ</li>
</ol>
<p>æ¸¬è©¦ä¸åŒè¼¸å…¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ‰æ•ˆç­”æ¡ˆ</span></span><br><span class="line">0 0</span><br><span class="line">1 0</span><br><span class="line">3 0</span><br><span class="line">7 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¡æ•ˆç­”æ¡ˆï¼ˆæœƒç¶“éåˆ†æ”¯ 3ï¼Œè¿”å›å€¼é 0ï¼‰</span></span><br><span class="line">2 0</span><br><span class="line">5 0</span><br></pre></td></tr></table></figure>
<p>é©—è­‰éç¨‹ï¼ˆä»¥è¼¸å…¥ 1 ç‚ºä¾‹ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ 1 æ¬¡ï¼šfunc4(1, 0, 14) â†’ mid=7, 7&gt;1 â†’ åˆ†æ”¯ 1 â†’ func4(1, 0, 6)</span><br><span class="line">ç¬¬ 2 æ¬¡ï¼šfunc4(1, 0, 6)  â†’ mid=3, 3&gt;1 â†’ åˆ†æ”¯ 1 â†’ func4(1, 0, 2)</span><br><span class="line">ç¬¬ 3 æ¬¡ï¼šfunc4(1, 0, 2)  â†’ mid=1, 1==1 â†’ åˆ†æ”¯ 2 â†’ è¿”å› 0</span><br><span class="line">å›åˆ°ç¬¬ 2 æ¬¡ï¼šè¿”å›å€¼ = 0 * 2 = 0</span><br><span class="line">å›åˆ°ç¬¬ 1 æ¬¡ï¼šè¿”å›å€¼ = 0 * 2 = 0</span><br></pre></td></tr></table></figure>
<p>ç­”æ¡ˆï¼ˆ4 é¸ 1ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 0</span><br><span class="line">1 0  â† é¸é€™çµ„</span><br><span class="line">3 0</span><br><span class="line">7 0</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒå€‹æ•¸å­—å¿…é ˆæ˜¯ 0ï¼ˆphase_4 æœƒæª¢æŸ¥ï¼‰ã€‚</p>
<p>å­¸ç¿’é‡é»</p>
<ul>
<li>ç†è§£éè¿´å‡½æ•¸çš„åˆ†ææ–¹æ³•
<ul>
<li>æ‰¾ base caseï¼ˆçµ‚æ­¢æ¢ä»¶ï¼‰</li>
<li>æ‰¾ recursive caseï¼ˆéè¿´å‘¼å«ï¼‰</li>
<li>è¿½è¹¤åƒæ•¸å¦‚ä½•æ”¹è®Š</li>
</ul>
</li>
<li>ä½¿ç”¨ gdb è¿½è¹¤éè¿´
<ul>
<li><code>si</code> é€²å…¥å‡½æ•¸ï¼ˆvs <code>ni</code> è·³éå‡½æ•¸ï¼‰</li>
<li><code>backtrace</code> æŸ¥çœ‹å‘¼å«å †ç–Š</li>
<li>è§€å¯Ÿæ¯å±¤éè¿´çš„åƒæ•¸è®ŠåŒ–</li>
</ul>
</li>
<li>äºŒåˆ†æœå°‹çš„çµ„èªå¯¦ä½œ
<ul>
<li>è¨ˆç®—ä¸­é»ï¼š<code>(low + high) / 2</code></li>
<li>ä¸‰è·¯åˆ†æ”¯ï¼šå°æ–¼ã€ç­‰æ–¼ã€å¤§æ–¼</li>
<li>éè¿´ç¸®å°æœå°‹ç¯„åœ</li>
</ul>
</li>
<li>è¿”å›å€¼çš„è¨ˆç®—è¦å¾‹
<ul>
<li>åˆ†æ”¯ 2ï¼ˆæ‰¾åˆ°ï¼‰ï¼šè¿”å› 0</li>
<li>åˆ†æ”¯ 1ï¼ˆå·¦åŠï¼‰ï¼šè¿”å›å€¼ * 2</li>
<li>åˆ†æ”¯ 3ï¼ˆå³åŠï¼‰ï¼šè¿”å›å€¼ * 2 + 1</li>
</ul>
</li>
</ul>
<p>é‡è¦ GDB æŒ‡ä»¤è£œå……</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">backtrace (bt)          <span class="comment"># é¡¯ç¤ºå‡½æ•¸å‘¼å«å †ç–Š</span></span><br><span class="line">info registers          <span class="comment"># é¡¯ç¤ºæ‰€æœ‰æš«å­˜å™¨å€¼</span></span><br><span class="line">info registers rdi rsi  <span class="comment"># åªé¡¯ç¤ºç‰¹å®šæš«å­˜å™¨</span></span><br><span class="line">finish                  <span class="comment"># åŸ·è¡Œå®Œç•¶å‰å‡½æ•¸è¿”å›ä¸Šä¸€å±¤</span></span><br></pre></td></tr></table></figure>
<p>é¡å¤–è§€å¯Ÿé€™å€‹ phase å±•ç¤ºäº†ï¼š</p>
<ul>
<li>éè¿´å‡½æ•¸åœ¨çµ„èªä¸­çš„æ¨£å­</li>
<li>å¦‚ä½•é€šéè¿”å›å€¼ç·¨ç¢¼ä¸åŒçš„è·¯å¾‘</li>
<li>ç‚ºä»€éº¼æŸäº›çœ‹ä¼¼åˆç†çš„è¼¸å…¥æœƒå¤±æ•—ï¼ˆä¸åœ¨äºŒåˆ†æœå°‹çš„ã€Œè‡ªç„¶è·¯å¾‘ã€ä¸Šï¼‰</li>
</ul>
<h2 id="ğŸ³-Phase-5">ğŸ³ Phase 5</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> phase_5</span><br><span class="line">Breakpoint 1 at 0x401062</span><br><span class="line">(gdb) run solution.txt</span><br><span class="line">Starting program: /home/nvidia/Desktop/bomb/bomb solution.txt</span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line"><span class="built_in">which</span> to blow yourself up. Have a <span class="built_in">nice</span> day!</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">That<span class="string">&#x27;s number 2.  Keep going!</span></span><br><span class="line"><span class="string">Halfway there!</span></span><br><span class="line"><span class="string">So you got that one.  Try this one.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Breakpoint 1, 0x0000000000401062 in phase_5 ()</span></span><br><span class="line"><span class="string">(gdb) disassemble</span></span><br><span class="line"><span class="string">Dump of assembler code for function phase_5:</span></span><br><span class="line"><span class="string">=&gt; 0x0000000000401062 &lt;+0&gt;:	push   %rbx</span></span><br><span class="line"><span class="string">   0x0000000000401063 &lt;+1&gt;:	sub    $0x20,%rsp</span></span><br><span class="line"><span class="string">   0x0000000000401067 &lt;+5&gt;:	mov    %rdi,%rbx</span></span><br><span class="line"><span class="string">   0x000000000040106a &lt;+8&gt;:	mov    %fs:0x28,%rax</span></span><br><span class="line"><span class="string">   0x0000000000401073 &lt;+17&gt;:	mov    %rax,0x18(%rsp)</span></span><br><span class="line"><span class="string">   0x0000000000401078 &lt;+22&gt;:	xor    %eax,%eax</span></span><br><span class="line"><span class="string">   0x000000000040107a &lt;+24&gt;:	callq  0x40131b &lt;string_length&gt;</span></span><br><span class="line"><span class="string">   0x000000000040107f &lt;+29&gt;:	cmp    $0x6,%eax</span></span><br><span class="line"><span class="string">   0x0000000000401082 &lt;+32&gt;:	je     0x4010d2 &lt;phase_5+112&gt;</span></span><br><span class="line"><span class="string">   0x0000000000401084 &lt;+34&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span></span><br><span class="line"><span class="string">   0x0000000000401089 &lt;+39&gt;:	jmp    0x4010d2 &lt;phase_5+112&gt;</span></span><br><span class="line"><span class="string">   0x000000000040108b &lt;+41&gt;:	movzbl (%rbx,%rax,1),%ecx</span></span><br><span class="line"><span class="string">   0x000000000040108f &lt;+45&gt;:	mov    %cl,(%rsp)</span></span><br><span class="line"><span class="string">   0x0000000000401092 &lt;+48&gt;:	mov    (%rsp),%rdx</span></span><br><span class="line"><span class="string">   0x0000000000401096 &lt;+52&gt;:	and    $0xf,%edx</span></span><br><span class="line"><span class="string">   0x0000000000401099 &lt;+55&gt;:	movzbl 0x4024b0(%rdx),%edx</span></span><br><span class="line"><span class="string">   0x00000000004010a0 &lt;+62&gt;:	mov    %dl,0x10(%rsp,%rax,1)</span></span><br><span class="line"><span class="string">   0x00000000004010a4 &lt;+66&gt;:	add    $0x1,%rax</span></span><br><span class="line"><span class="string">   0x00000000004010a8 &lt;+70&gt;:	cmp    $0x6,%rax</span></span><br><span class="line"><span class="string">   0x00000000004010ac &lt;+74&gt;:	jne    0x40108b &lt;phase_5+41&gt;</span></span><br><span class="line"><span class="string">   0x00000000004010ae &lt;+76&gt;:	movb   $0x0,0x16(%rsp)</span></span><br><span class="line"><span class="string">   0x00000000004010b3 &lt;+81&gt;:	mov    $0x40245e,%esi</span></span><br><span class="line"><span class="string">   0x00000000004010b8 &lt;+86&gt;:	lea    0x10(%rsp),%rdi</span></span><br><span class="line"><span class="string">   0x00000000004010bd &lt;+91&gt;:	callq  0x401338 &lt;strings_not_equal&gt;</span></span><br><span class="line"><span class="string">   0x00000000004010c2 &lt;+96&gt;:	test   %eax,%eax</span></span><br><span class="line"><span class="string">   0x00000000004010c4 &lt;+98&gt;:	je     0x4010d9 &lt;phase_5+119&gt;</span></span><br><span class="line"><span class="string">   0x00000000004010c6 &lt;+100&gt;:	callq  0x40143a &lt;explode_bomb&gt;</span></span><br><span class="line"><span class="string">   0x00000000004010cb &lt;+105&gt;:	nopl   0x0(%rax,%rax,1)</span></span><br><span class="line"><span class="string">   0x00000000004010d0 &lt;+110&gt;:	jmp    0x4010d9 &lt;phase_5+119&gt;</span></span><br><span class="line"><span class="string">   0x00000000004010d2 &lt;+112&gt;:	mov    $0x0,%eax</span></span><br><span class="line"><span class="string">   0x00000000004010d7 &lt;+117&gt;:	jmp    0x40108b &lt;phase_5+41&gt;</span></span><br><span class="line"><span class="string">   0x00000000004010d9 &lt;+119&gt;:	mov    0x18(%rsp),%rax</span></span><br><span class="line"><span class="string">   0x00000000004010de &lt;+124&gt;:	xor    %fs:0x28,%rax</span></span><br><span class="line"><span class="string">   0x00000000004010e7 &lt;+133&gt;:	je     0x4010ee &lt;phase_5+140&gt;</span></span><br><span class="line"><span class="string">   0x00000000004010e9 &lt;+135&gt;:	callq  0x400b30 &lt;__stack_chk_fail@plt&gt;</span></span><br><span class="line"><span class="string">   0x00000000004010ee &lt;+140&gt;:	add    $0x20,%rsp</span></span><br><span class="line"><span class="string">   0x00000000004010f2 &lt;+144&gt;:	pop    %rbx</span></span><br><span class="line"><span class="string">   0x00000000004010f3 &lt;+145&gt;:	retq</span></span><br><span class="line"><span class="string">End of assembler dump.</span></span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-è§£é¡Œé‚è¼¯">ğŸ¦€ è§£é¡Œé‚è¼¯</h3>
<p>è¼¸å…¥ 6 å€‹å­—å…ƒ â†’ æ¯å€‹å­—å…ƒå–ä½ 4 bits ç•¶ç´¢å¼• â†’ æŸ¥è¡¨è½‰æ› â†’ å¿…é ˆè®Šæˆ â€œflyersâ€</p>
<h3 id="ğŸ¦€-é—œéµæŒ‡ä»¤è§£æ">ğŸ¦€ é—œéµæŒ‡ä»¤è§£æ</h3>
<ol>
<li>é•·åº¦æª¢æŸ¥ (+24 ~ +34)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">callq  0x40131b &lt;string_length&gt;</span><br><span class="line">cmp    $0x6,%eax</span><br><span class="line">je     0x4010d2 &lt;phase_5+112&gt;</span><br><span class="line">callq  0x40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<p>â†’ è¼¸å…¥å¿…é ˆæ˜¯ 6 å€‹å­—å…ƒ</p>
<ol start="2">
<li>åˆå§‹åŒ– loop counter (+112)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov    $0x0,%eax</span><br><span class="line">jmp    0x40108b &lt;phase_5+41&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>%eax</code> = 0ï¼ˆè¿´åœˆè¨ˆæ•¸å™¨ï¼‰</li>
</ul>
<ol start="3">
<li>æ ¸å¿ƒè½‰æ›è¿´åœˆ (+41 ~ +74)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">movzbl (%rbx,%rax,1),%ecx      # è®€å–è¼¸å…¥å­—ä¸²ç¬¬ i å€‹å­—å…ƒ</span><br><span class="line">mov    %cl,(%rsp)              # æš«å­˜åˆ° stack</span><br><span class="line">mov    (%rsp),%rdx             # è®€å›åˆ° %rdx</span><br><span class="line">and    $0xf,%edx               # å–ä½ 4 bits (0-15)</span><br><span class="line">movzbl 0x4024b0(%rdx),%edx     # æŸ¥è¡¨ï¼key instruction</span><br><span class="line">mov    %dl,0x10(%rsp,%rax,1)   # å­˜çµæœåˆ° stack offset 0x10</span><br><span class="line">add    $0x1,%rax               # i++</span><br><span class="line">cmp    $0x6,%rax               # è¿´åœˆ 6 æ¬¡</span><br><span class="line">jne    0x40108b &lt;phase_5+41&gt;</span><br></pre></td></tr></table></figure>
<p>é—œéµæ¦‚å¿µï¼š</p>
<ul>
<li><code>and $0xf, %edx</code>ï¼šåªä¿ç•™å­—å…ƒçš„ä½ 4 bits</li>
<li><code>0x4024b0(%rdx)</code>ï¼šbase + index å®šå€ï¼Œå¾æŸ¥è¡¨é™£åˆ—å–å­—å…ƒ</li>
<li>è½‰æ›å¾Œçš„å­—ä¸²å­˜åœ¨ <code>%rsp + 0x10</code></li>
</ul>
<ol start="4">
<li>å­—ä¸²æ¯”è¼ƒ (+76 ~ +100)</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">movb   $0x0,0x16(%rsp)         # åŠ  null terminator</span><br><span class="line">mov    $0x40245e,%esi          # &quot;flyers&quot; å­—ä¸²ä½å€</span><br><span class="line">lea    0x10(%rsp),%rdi         # è½‰æ›å¾Œçš„å­—ä¸²</span><br><span class="line">callq  0x401338 &lt;strings_not_equal&gt;</span><br><span class="line">test   %eax,%eax</span><br><span class="line">je     0x4010d9 &lt;phase_5+119&gt;  # ç›¸ç­‰å°±é€šé</span><br><span class="line">callq  0x40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-è§£é¡Œæ­¥é©Ÿ">ğŸ¦€ è§£é¡Œæ­¥é©Ÿ</h3>
<ol>
<li>æŸ¥çœ‹æŸ¥è¡¨é™£åˆ—</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x4024b0</span><br></pre></td></tr></table></figure>
<p>æ‰¾å‡ºç´¢å¼• 0-15 å°æ‡‰çš„å­—å…ƒ</p>
<ol start="2">
<li>åæ¨è¼¸å…¥</li>
</ol>
<ul>
<li>ç›®æ¨™ï¼šâ€˜fâ€™, â€˜lâ€™, â€˜yâ€™, â€˜eâ€™, â€˜râ€™, â€˜sâ€™</li>
<li>æ‰¾å‡ºæŸ¥è¡¨é™£åˆ—ä¸­é€™äº›å­—æ¯çš„ç´¢å¼•ä½ç½®</li>
<li>æ‰¾ä»»æ„ ASCII å­—å…ƒï¼Œå…¶ä½ 4 bits ç­‰æ–¼é€™äº›ç´¢å¼•</li>
</ul>
<ol start="3">
<li>é©—è­‰</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) break *0x4010bd</span><br><span class="line">(gdb) x/s $rdi              # æª¢æŸ¥è½‰æ›çµæœ</span><br><span class="line">(gdb) x/s 0x40245e          # ç¢ºèªç›®æ¨™æ˜¯ &quot;flyers&quot;</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-æ–°å­¸åˆ°çš„æŒ‡ä»¤">ğŸ¦€ æ–°å­¸åˆ°çš„æŒ‡ä»¤</h3>
<ul>
<li><code>movzbl src, dst</code>ï¼šmove zero-extend byte to long
<ul>
<li>è®€ 1 byteï¼Œæ”¾é€² 32-bit æš«å­˜å™¨ï¼Œé«˜ä½è£œ 0</li>
</ul>
</li>
<li><code>and $0xf, %reg</code>ï¼šbit masking
<ul>
<li>å–æœ€ä½ 4 bitsï¼ˆç¯„åœ 0-15ï¼‰</li>
</ul>
</li>
<li><code>addr(%base, %index, scale)</code>ï¼šé™£åˆ—å®šå€
<ul>
<li>è¨ˆç®—ï¼šbase + index Ã— scale</li>
<li>ä¾‹ï¼š<code>0x4024b0(%rdx)</code> = 0x4024b0 + %rdx</li>
</ul>
</li>
</ul>
<h2 id="ğŸ³-Phase-6">ğŸ³ Phase 6</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">Breakpoint 1, 0x00000000004010f4 <span class="keyword">in</span> phase_6 ()</span><br><span class="line">(gdb) disassemble</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> <span class="keyword">function</span> phase_6:</span><br><span class="line">=&gt; 0x00000000004010f4 &lt;+0&gt;:	push   %r14</span><br><span class="line">   0x00000000004010f6 &lt;+2&gt;:	push   %r13</span><br><span class="line">   0x00000000004010f8 &lt;+4&gt;:	push   %r12</span><br><span class="line">   0x00000000004010fa &lt;+6&gt;:	push   %rbp</span><br><span class="line">   0x00000000004010fb &lt;+7&gt;:	push   %rbx</span><br><span class="line">   0x00000000004010fc &lt;+8&gt;:	sub    <span class="variable">$0x50</span>,%rsp</span><br><span class="line">   0x0000000000401100 &lt;+12&gt;:	mov    %rsp,%r13</span><br><span class="line">   0x0000000000401103 &lt;+15&gt;:	mov    %rsp,%rsi</span><br><span class="line">   0x0000000000401106 &lt;+18&gt;:	call   0x40145c &lt;read_six_numbers&gt;</span><br><span class="line">   0x000000000040110b &lt;+23&gt;:	mov    %rsp,%r14</span><br><span class="line">   0x000000000040110e &lt;+26&gt;:	mov    <span class="variable">$0x0</span>,%r12d</span><br><span class="line">   0x0000000000401114 &lt;+32&gt;:	mov    %r13,%rbp</span><br><span class="line">   0x0000000000401117 &lt;+35&gt;:	mov    0x0(%r13),%eax</span><br><span class="line">   0x000000000040111b &lt;+39&gt;:	sub    <span class="variable">$0x1</span>,%eax</span><br><span class="line">   0x000000000040111e &lt;+42&gt;:	cmp    <span class="variable">$0x5</span>,%eax</span><br><span class="line">   0x0000000000401121 &lt;+45&gt;:	jbe    0x401128 &lt;phase_6+52&gt;</span><br><span class="line">   0x0000000000401123 &lt;+47&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401128 &lt;+52&gt;:	add    <span class="variable">$0x1</span>,%r12d</span><br><span class="line">   0x000000000040112c &lt;+56&gt;:	cmp    <span class="variable">$0x6</span>,%r12d</span><br><span class="line">   0x0000000000401130 &lt;+60&gt;:	je     0x401153 &lt;phase_6+95&gt;</span><br><span class="line">   0x0000000000401132 &lt;+62&gt;:	mov    %r12d,%ebx</span><br><span class="line">   0x0000000000401135 &lt;+65&gt;:	movslq %ebx,%rax</span><br><span class="line">   0x0000000000401138 &lt;+68&gt;:	mov    (%rsp,%rax,4),%eax</span><br><span class="line">   0x000000000040113b &lt;+71&gt;:	cmp    %eax,0x0(%rbp)</span><br><span class="line">   0x000000000040113e &lt;+74&gt;:	jne    0x401145 &lt;phase_6+81&gt;</span><br><span class="line">   0x0000000000401140 &lt;+76&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x0000000000401145 &lt;+81&gt;:	add    <span class="variable">$0x1</span>,%ebx</span><br><span class="line">   0x0000000000401148 &lt;+84&gt;:	cmp    <span class="variable">$0x5</span>,%ebx</span><br><span class="line">   0x000000000040114b &lt;+87&gt;:	jle    0x401135 &lt;phase_6+65&gt;</span><br><span class="line">   0x000000000040114d &lt;+89&gt;:	add    <span class="variable">$0x4</span>,%r13</span><br><span class="line">   0x0000000000401151 &lt;+93&gt;:	jmp    0x401114 &lt;phase_6+32&gt;</span><br><span class="line">   0x0000000000401153 &lt;+95&gt;:	lea    0x18(%rsp),%rsi</span><br><span class="line">--Type &lt;RET&gt; <span class="keyword">for</span> more, q to quit, c to <span class="built_in">continue</span> without paging--</span><br><span class="line">   0x0000000000401158 &lt;+100&gt;:	mov    %r14,%rax</span><br><span class="line">   0x000000000040115b &lt;+103&gt;:	mov    <span class="variable">$0x7</span>,%ecx</span><br><span class="line">   0x0000000000401160 &lt;+108&gt;:	mov    %ecx,%edx</span><br><span class="line">   0x0000000000401162 &lt;+110&gt;:	sub    (%rax),%edx</span><br><span class="line">   0x0000000000401164 &lt;+112&gt;:	mov    %edx,(%rax)</span><br><span class="line">   0x0000000000401166 &lt;+114&gt;:	add    <span class="variable">$0x4</span>,%rax</span><br><span class="line">   0x000000000040116a &lt;+118&gt;:	cmp    %rsi,%rax</span><br><span class="line">   0x000000000040116d &lt;+121&gt;:	jne    0x401160 &lt;phase_6+108&gt;</span><br><span class="line"></span><br><span class="line">   0x000000000040116f &lt;+123&gt;:	mov    <span class="variable">$0x0</span>,%esi</span><br><span class="line">   0x0000000000401174 &lt;+128&gt;:	jmp    0x401197 &lt;phase_6+163&gt;</span><br><span class="line">   0x0000000000401176 &lt;+130&gt;:	mov    0x8(%rdx),%rdx</span><br><span class="line">   0x000000000040117a &lt;+134&gt;:	add    <span class="variable">$0x1</span>,%eax</span><br><span class="line">   0x000000000040117d &lt;+137&gt;:	cmp    %ecx,%eax</span><br><span class="line">   0x000000000040117f &lt;+139&gt;:	jne    0x401176 &lt;phase_6+130&gt;</span><br><span class="line">   0x0000000000401181 &lt;+141&gt;:	jmp    0x401188 &lt;phase_6+148&gt;</span><br><span class="line">   0x0000000000401183 &lt;+143&gt;:	mov    <span class="variable">$0x6032d0</span>,%edx</span><br><span class="line">   0x0000000000401188 &lt;+148&gt;:	mov    %rdx,0x20(%rsp,%rsi,2)</span><br><span class="line">   0x000000000040118d &lt;+153&gt;:	add    <span class="variable">$0x4</span>,%rsi</span><br><span class="line">   0x0000000000401191 &lt;+157&gt;:	cmp    <span class="variable">$0x18</span>,%rsi</span><br><span class="line">   0x0000000000401195 &lt;+161&gt;:	je     0x4011ab &lt;phase_6+183&gt;</span><br><span class="line">   0x0000000000401197 &lt;+163&gt;:	mov    (%rsp,%rsi,1),%ecx</span><br><span class="line">   0x000000000040119a &lt;+166&gt;:	cmp    <span class="variable">$0x1</span>,%ecx</span><br><span class="line">   0x000000000040119d &lt;+169&gt;:	jle    0x401183 &lt;phase_6+143&gt;</span><br><span class="line">   0x000000000040119f &lt;+171&gt;:	mov    <span class="variable">$0x1</span>,%eax</span><br><span class="line">   0x00000000004011a4 &lt;+176&gt;:	mov    <span class="variable">$0x6032d0</span>,%edx</span><br><span class="line">   0x00000000004011a9 &lt;+181&gt;:	jmp    0x401176 &lt;phase_6+130&gt;</span><br><span class="line"></span><br><span class="line">   0x00000000004011ab &lt;+183&gt;:	mov    0x20(%rsp),%rbx</span><br><span class="line">   0x00000000004011b0 &lt;+188&gt;:	lea    0x28(%rsp),%rax</span><br><span class="line">   0x00000000004011b5 &lt;+193&gt;:	lea    0x50(%rsp),%rsi</span><br><span class="line">   0x00000000004011ba &lt;+198&gt;:	mov    %rbx,%rcx</span><br><span class="line">   0x00000000004011bd &lt;+201&gt;:	mov    (%rax),%rdx</span><br><span class="line">   0x00000000004011c0 &lt;+204&gt;:	mov    %rdx,0x8(%rcx)</span><br><span class="line">   0x00000000004011c4 &lt;+208&gt;:	add    <span class="variable">$0x8</span>,%rax</span><br><span class="line">--Type &lt;RET&gt; <span class="keyword">for</span> more, q to quit, c to <span class="built_in">continue</span> without paging--</span><br><span class="line">   0x00000000004011c8 &lt;+212&gt;:	cmp    %rsi,%rax</span><br><span class="line">   0x00000000004011cb &lt;+215&gt;:	je     0x4011d2 &lt;phase_6+222&gt;</span><br><span class="line">   0x00000000004011cd &lt;+217&gt;:	mov    %rdx,%rcx</span><br><span class="line">   0x00000000004011d0 &lt;+220&gt;:	jmp    0x4011bd &lt;phase_6+201&gt;</span><br><span class="line">   0x00000000004011d2 &lt;+222&gt;:	movq   <span class="variable">$0x0</span>,0x8(%rdx)</span><br><span class="line">   0x00000000004011da &lt;+230&gt;:	mov    <span class="variable">$0x5</span>,%ebp</span><br><span class="line">   0x00000000004011df &lt;+235&gt;:	mov    0x8(%rbx),%rax</span><br><span class="line">   0x00000000004011e3 &lt;+239&gt;:	mov    (%rax),%eax</span><br><span class="line">   0x00000000004011e5 &lt;+241&gt;:	cmp    %eax,(%rbx)</span><br><span class="line">   0x00000000004011e7 &lt;+243&gt;:	jge    0x4011ee &lt;phase_6+250&gt;</span><br><span class="line">   0x00000000004011e9 &lt;+245&gt;:	call   0x40143a &lt;explode_bomb&gt;</span><br><span class="line">   0x00000000004011ee &lt;+250&gt;:	mov    0x8(%rbx),%rbx</span><br><span class="line">   0x00000000004011f2 &lt;+254&gt;:	sub    <span class="variable">$0x1</span>,%ebp</span><br><span class="line">   0x00000000004011f5 &lt;+257&gt;:	jne    0x4011df &lt;phase_6+235&gt;</span><br><span class="line">   0x00000000004011f7 &lt;+259&gt;:	add    <span class="variable">$0x50</span>,%rsp</span><br><span class="line">   0x00000000004011fb &lt;+263&gt;:	pop    %rbx</span><br><span class="line">   0x00000000004011fc &lt;+264&gt;:	pop    %rbp</span><br><span class="line">   0x00000000004011fd &lt;+265&gt;:	pop    %r12</span><br><span class="line">   0x00000000004011ff &lt;+267&gt;:	pop    %r13</span><br><span class="line">   0x0000000000401201 &lt;+269&gt;:	pop    %r14</span><br><span class="line">   0x0000000000401203 &lt;+271&gt;:	ret</span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-è§£é¡Œé‚è¼¯-2">ğŸ¦€ è§£é¡Œé‚è¼¯</h3>
<p>è¼¸å…¥ 6 å€‹æ•¸å­—ï¼ˆ1-6 ä¸”ä¸é‡è¤‡ï¼‰<br>
â†’ è½‰æ›æˆ <code>7-x</code><br>
â†’ æ ¹æ“šè½‰æ›å€¼é¸æ“‡å°æ‡‰çš„ node(æŒ‡æ¨™é™£åˆ—)<br>
â†’ é‡æ’ linked list<br>
â†’ æª¢æŸ¥ node çš„å€¼æ˜¯å¦éæ¸›</p>
<h3 id="ğŸ¦€-å®Œæ•´-Assembly-Code-åˆ†æ">ğŸ¦€ å®Œæ•´ Assembly Code åˆ†æ</h3>
<h4 id="ç¬¬ä¸€æ®µï¼šå‡½æ•¸åˆå§‹åŒ–-0-18">ç¬¬ä¸€æ®µï¼šå‡½æ•¸åˆå§‹åŒ– (+0 ~ +18)</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">push   %r14</span><br><span class="line">push   %r13</span><br><span class="line">push   %r12</span><br><span class="line">push   %rbp</span><br><span class="line">push   %rbx</span><br><span class="line">sub    $0x50,%rsp              # åˆ†é… 80 bytes stack ç©ºé–“</span><br><span class="line">mov    %rsp,%r13               # r13 = stack èµ·å§‹ä½å€</span><br><span class="line">mov    %rsp,%rsi               # rsi = ç¬¬äºŒå€‹åƒæ•¸ï¼ˆè¼¸å‡ºé™£åˆ—ä½å€ï¼‰</span><br><span class="line">call   0x40145c &lt;read_six_numbers&gt;</span><br></pre></td></tr></table></figure>
<p>é—œéµæ¦‚å¿µï¼š</p>
<ul>
<li>ä¿å­˜ callee-saved registers</li>
<li><code>read_six_numbers(input_string, output_array)</code>
<ul>
<li>ç¬¬ä¸€å€‹åƒæ•¸ <code>%rdi</code>ï¼šè¼¸å…¥å­—ä¸²ï¼ˆåœ¨é€²å…¥ phase_6 å‰å·²è¨­å®šï¼‰</li>
<li>ç¬¬äºŒå€‹åƒæ•¸ <code>%rsi</code>ï¼šç›®çš„åœ°é™£åˆ—ä½å€ï¼ˆstackï¼‰</li>
<li>å‡½æ•¸å…§éƒ¨ç”¨ <code>sscanf</code> è§£æï¼Œå°‡ 6 å€‹æ•´æ•¸å¯«å…¥ <code>%rsi</code> æŒ‡å‘çš„ä½ç½®</li>
</ul>
</li>
</ul>
<h4 id="ç¬¬äºŒæ®µï¼šæª¢æŸ¥æ•¸å­—ç¯„åœèˆ‡å”¯ä¸€æ€§-23-93">ç¬¬äºŒæ®µï¼šæª¢æŸ¥æ•¸å­—ç¯„åœèˆ‡å”¯ä¸€æ€§ (+23 ~ +93)</h4>
<p>å¤–å±¤è¿´åœˆï¼šæª¢æŸ¥æ¯å€‹æ•¸å­—æ˜¯å¦åœ¨ 1-6 ç¯„åœå…§ (+32 ~ +60)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mov    %rsp,%r14               # r14 = é™£åˆ—èµ·å§‹ä½å€ï¼ˆå‚™ä»½ï¼‰</span><br><span class="line">mov    $0x0,%r12d              # r12d = å¤–å±¤è¿´åœˆè¨ˆæ•¸å™¨ i = 0</span><br><span class="line">mov    %r13,%rbp               # rbp = ç•¶å‰å…ƒç´ ä½å€</span><br><span class="line"></span><br><span class="line"># Loop 1 é–‹å§‹:</span><br><span class="line">mov    0x0(%r13),%eax          # eax = array[i]</span><br><span class="line">sub    $0x1,%eax               # eax = array[i] - 1</span><br><span class="line">cmp    $0x5,%eax               # æª¢æŸ¥ (array[i] - 1) &lt;= 5</span><br><span class="line">jbe    0x401128                # é€šéï¼ˆå³ 1 &lt;= array[i] &lt;= 6ï¼‰</span><br><span class="line">call   explode_bomb            # å¦å‰‡çˆ†ç‚¸</span><br><span class="line"></span><br><span class="line">add    $0x1,%r12d              # i++</span><br><span class="line">cmp    $0x6,%r12d              # i == 6?</span><br><span class="line">je     0x401153                # æ˜¯ï¼Œè·³åˆ°ä¸‹ä¸€æ®µ</span><br></pre></td></tr></table></figure>
<p>å…§å±¤è¿´åœˆï¼šæª¢æŸ¥æ•¸å­—ä¸é‡è¤‡ (+62 ~ +93)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mov    %r12d,%ebx              # ebx = i + 1ï¼ˆå¾ä¸‹ä¸€å€‹é–‹å§‹æ¯”è¼ƒï¼‰</span><br><span class="line">movslq %ebx,%rax               # rax = ebxï¼ˆç¬¦è™Ÿæ“´å±•åˆ° 64-bitï¼‰</span><br><span class="line">mov    (%rsp,%rax,4),%eax      # eax = array[j]ï¼ˆç¬¬ j å€‹å…ƒç´ ï¼‰</span><br><span class="line">cmp    %eax,0x0(%rbp)          # æ¯”è¼ƒ array[i] == array[j]?</span><br><span class="line">jne    0x401145                # ä¸ç›¸ç­‰ï¼Œç¹¼çºŒ</span><br><span class="line">call   explode_bomb            # ç›¸ç­‰ï¼Œçˆ†ç‚¸ï¼ˆé‡è¤‡äº†ï¼‰</span><br><span class="line"></span><br><span class="line">add    $0x1,%ebx               # j++</span><br><span class="line">cmp    $0x5,%ebx               # j &lt;= 5?</span><br><span class="line">jle    0x401135                # ç¹¼çºŒå…§å±¤è¿´åœˆ</span><br><span class="line"></span><br><span class="line">add    $0x4,%r13               # r13 += 4ï¼ˆç§»åˆ°ä¸‹ä¸€å€‹å…ƒç´ ï¼‰</span><br><span class="line">jmp    0x401114                # å›åˆ°å¤–å±¤è¿´åœˆ</span><br></pre></td></tr></table></figure>
<p>ç­‰åƒ¹ C ç¨‹å¼ç¢¼ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤–å±¤è¿´åœˆï¼šæª¢æŸ¥ç¯„åœ</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">array</span>[i] &lt; <span class="number">1</span> || <span class="built_in">array</span>[i] &gt; <span class="number">6</span>) &#123;</span><br><span class="line">        explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…§å±¤è¿´åœˆï¼šæª¢æŸ¥ä¸é‡è¤‡</span></span><br><span class="line">    <span class="keyword">for</span> (j = i + <span class="number">1</span>; j &lt;= <span class="number">5</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">array</span>[i] == <span class="built_in">array</span>[j]) &#123;</span><br><span class="line">            explode_bomb();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é—œéµæŒ‡ä»¤è§£æï¼š</p>
<ul>
<li><code>(%rsp,%rax,4)</code>ï¼šé™£åˆ—å®šå€ = <code>rsp + rax Ã— 4</code>ï¼ˆå› ç‚º int æ˜¯ 4 bytesï¼‰</li>
<li><code>0x0(%rbp)</code>ï¼šç•¶å‰æ¯”è¼ƒçš„åŸºæº–å…ƒç´ </li>
<li><code>movslq</code>ï¼šmove with sign-extension long to quadï¼ˆå¸¶ç¬¦è™Ÿæ“´å±•ï¼‰</li>
</ul>
<h4 id="ç¬¬ä¸‰æ®µï¼šè½‰æ›æˆ-7-x-95-121">ç¬¬ä¸‰æ®µï¼šè½‰æ›æˆ 7-x (+95 ~ +121)</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">lea    0x18(%rsp),%rsi         # rsi = é™£åˆ—çµå°¾ä½å€ï¼ˆrsp + 24ï¼‰</span><br><span class="line">mov    %r14,%rax               # rax = é™£åˆ—èµ·å§‹ä½å€</span><br><span class="line"></span><br><span class="line"># Loop:</span><br><span class="line">mov    $0x7,%ecx               # ecx = 7</span><br><span class="line">mov    %ecx,%edx               # edx = 7</span><br><span class="line">sub    (%rax),%edx             # edx = 7 - array[i]</span><br><span class="line">mov    %edx,(%rax)             # array[i] = 7 - array[i]</span><br><span class="line">add    $0x4,%rax               # ç§»åˆ°ä¸‹ä¸€å€‹å…ƒç´ </span><br><span class="line">cmp    %rsi,%rax               # è™•ç†å®Œ 6 å€‹äº†å—ï¼Ÿ</span><br><span class="line">jne    0x401160                # ç¹¼çºŒè¿´åœˆ</span><br></pre></td></tr></table></figure>
<p>ç‚ºä»€éº¼æ˜¯ <code>0x18</code>ï¼Ÿ</p>
<ul>
<li>6 å€‹ int Ã— 4 bytes = 24 (0x18) bytes</li>
<li><code>%rsp + 0x18</code> æ˜¯é™£åˆ—çš„çµæŸä½ç½®ï¼ˆä¸‹ä¸€å€‹ä½å€ï¼‰</li>
</ul>
<h4 id="ç¬¬å››æ®µï¼šæ ¹æ“šè½‰æ›å€¼æ‰¾å°æ‡‰çš„-Node-123-161">ç¬¬å››æ®µï¼šæ ¹æ“šè½‰æ›å€¼æ‰¾å°æ‡‰çš„ Node (+123 ~ +161)</h4>
<p>Stack è¨˜æ†¶é«”ä½ˆå±€ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%rsp + 0x00: [è¼¸å…¥é™£åˆ—]  int[6]ï¼Œæ¯å€‹ 4 bytesï¼Œå…± 24 bytes</span><br><span class="line">%rsp + 0x20: [Node æŒ‡æ¨™é™£åˆ—] ptr[6]ï¼Œæ¯å€‹ 8 bytesï¼Œå…± 48 bytes</span><br><span class="line">%rsp + 0x50: æŒ‡æ¨™é™£åˆ—çµå°¾</span><br></pre></td></tr></table></figure>
<p>è¿´åœˆåˆå§‹åŒ– (+123):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov    $0x0,%esi               # esi = 0ï¼ˆé™£åˆ—ç´¢å¼•ï¼‰</span><br><span class="line">jmp    0x401197</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦é‚è¼¯ (+163 ~ +161):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># è®€å–è½‰æ›å¾Œçš„æ•¸å­—</span><br><span class="line">mov    (%rsp,%rsi,1),%ecx      # ecx = array[i]ï¼ˆ7-x çš„å€¼ï¼‰</span><br><span class="line">cmp    $0x1,%ecx               # ecx &lt;= 1?</span><br><span class="line">jle    0x401183                # æ˜¯ï¼Œç›´æ¥ç”¨ node1</span><br><span class="line"></span><br><span class="line"># ecx &gt; 1ï¼Œéœ€è¦èµ° linked list</span><br><span class="line">mov    $0x1,%eax               # eax = 1ï¼ˆcounterï¼šç›®å‰åœ¨ç¬¬å¹¾å€‹ nodeï¼‰</span><br><span class="line">mov    $0x6032d0,%edx          # edx = node1 ä½å€</span><br><span class="line">jmp    0x401176</span><br><span class="line"></span><br><span class="line"># èµ°è¨ª linked list (+130 ~ +139)</span><br><span class="line">mov    0x8(%rdx),%rdx          # rdx = rdx-&gt;next</span><br><span class="line">add    $0x1,%eax               # counter++</span><br><span class="line">cmp    %ecx,%eax               # counter == ecx?</span><br><span class="line">jne    0x401176                # å¦ï¼Œç¹¼çºŒèµ°</span><br><span class="line">jmp    0x401188                # æ˜¯ï¼Œæ‰¾åˆ°äº†</span><br><span class="line"></span><br><span class="line"># å¦‚æœ ecx &lt;= 1ï¼Œç›´æ¥ç”¨ node1 (+143)</span><br><span class="line">mov    $0x6032d0,%edx          # edx = node1</span><br><span class="line"></span><br><span class="line"># å­˜ node æŒ‡æ¨™åˆ°æ–°é™£åˆ— (+148)</span><br><span class="line">mov    %rdx,0x20(%rsp,%rsi,2)  # node_ptr_array[i] = rdx</span><br><span class="line">add    $0x4,%rsi               # i += 4ï¼ˆç´¢å¼•éå¢ï¼‰</span><br><span class="line">cmp    $0x18,%rsi              # i == 24?ï¼ˆè™•ç†å®Œ 6 å€‹ï¼‰</span><br><span class="line">je     0x4011ab                # æ˜¯ï¼ŒçµæŸ</span><br><span class="line">jmp    0x401197                # ç¹¼çºŒä¸‹ä¸€å€‹</span><br></pre></td></tr></table></figure>
<p>é—œéµæ¦‚å¿µï¼š</p>
<ol>
<li>
<p>Linked List çµæ§‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> value;        <span class="comment">// offset 0x0</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">next</span>;</span> <span class="comment">// offset 0x8</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>èµ°è¨ª Linked Listï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov 0x8(%rdx),%rdx    # rdx = rdx-&gt;next</span><br></pre></td></tr></table></figure>
<ul>
<li>é€é offset <code>0x8</code> è®€å– next pointer</li>
<li>ä¸æ˜¯é€£çºŒè¨˜æ†¶é«”ï¼Œæ˜¯é€éæŒ‡æ¨™è·³è½‰</li>
</ul>
</li>
<li>
<p>ç‚ºä»€éº¼ <code>0x20(%rsp,%rsi,2)</code> ä½† <code>add $0x4,%rsi</code>ï¼Ÿ</p>
<ul>
<li>è®€è¼¸å…¥ï¼š<code>(%rsp,%rsi,1)</code> â†’ <code>rsp + rsi Ã— 1</code></li>
<li>å¯«æŒ‡æ¨™ï¼š<code>0x20(%rsp,%rsi,2)</code> â†’ <code>rsp + 0x20 + rsi Ã— 2</code></li>
<li><code>%rsi</code> æ¯æ¬¡ +4ï¼š
<ul>
<li>ç¬¬ 1 æ¬¡ï¼šrsi=0 â†’ è®€ <code>rsp[0]</code>ï¼Œå¯« <code>rsp+0x20[0]</code></li>
<li>ç¬¬ 2 æ¬¡ï¼šrsi=4 â†’ è®€ <code>rsp[4]</code>ï¼Œå¯« <code>rsp+0x20[8]</code></li>
<li>ç¬¬ 3 æ¬¡ï¼šrsi=8 â†’ è®€ <code>rsp[8]</code>ï¼Œå¯« <code>rsp+0x20[16]</code></li>
</ul>
</li>
<li>é€™æ¨£åŒæ™‚éæ­·å…©å€‹é™£åˆ—ï¼ˆè¼¸å…¥é™£åˆ— vs æŒ‡æ¨™é™£åˆ—ï¼‰</li>
</ul>
</li>
</ol>
<p>ç­‰åƒ¹ C ç¨‹å¼ç¢¼ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">node* node_array[<span class="number">6</span>];  <span class="comment">// åœ¨ stack offset 0x20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="type">int</span> steps = <span class="built_in">array</span>[i];  <span class="comment">// 7-x çš„å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (steps &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        node_array[i] = node1;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        node* current = node1;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt; steps; j++) &#123;</span><br><span class="line">            current = current-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        node_array[i] = current;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ç¬¬äº”æ®µï¼šé‡æ’-Linked-List-183-222">ç¬¬äº”æ®µï¼šé‡æ’ Linked List (+183 ~ +222)</h4>
<p>åˆå§‹åŒ– (+183 ~ +193):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov    0x20(%rsp),%rbx         # rbx = node_array[0]ï¼ˆç¬¬ä¸€å€‹ nodeï¼‰</span><br><span class="line">lea    0x28(%rsp),%rax         # rax = &amp;node_array[1]ï¼ˆç¬¬äºŒå€‹æŒ‡æ¨™ä½å€ï¼‰</span><br><span class="line">lea    0x50(%rsp),%rsi         # rsi = é™£åˆ—çµå°¾ä½å€ï¼ˆåœæ­¢æ¢ä»¶ï¼‰</span><br></pre></td></tr></table></figure>
<p>ç‚ºä»€éº¼çµå°¾æ˜¯ <code>0x50</code>ï¼Ÿ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">èµ·é»ï¼š0x20ï¼ˆ32ï¼‰</span><br><span class="line">6 å€‹æŒ‡æ¨™ Ã— 8 bytes = 48 (0x30)</span><br><span class="line">çµå°¾ï¼š0x20 + 0x30 = 0x50ï¼ˆ80ï¼‰</span><br><span class="line"></span><br><span class="line">16 é€²ä½åŠ æ³•ï¼ˆä¸æ˜¯ 10 é€²ä½ï¼‰ï¼š</span><br><span class="line">0x20 â†’ 0x28 â†’ 0x30 â†’ 0x38 â†’ 0x40 â†’ 0x48 â†’ 0x50</span><br><span class="line">ï¼ˆæ¯æ¬¡ +8ï¼Œå› ç‚ºæŒ‡æ¨™æ˜¯ 8 bytesï¼‰</span><br></pre></td></tr></table></figure>
<p>ä¸²é€£è¿´åœˆ (+198 ~ +220):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mov    %rbx,%rcx               # rcx = ç•¶å‰ node</span><br><span class="line">mov    (%rax),%rdx             # rdx = ä¸‹ä¸€å€‹ nodeï¼ˆå¾é™£åˆ—è®€æŒ‡æ¨™ï¼‰</span><br><span class="line">mov    %rdx,0x8(%rcx)          # current-&gt;next = nextï¼ˆè¨­å®š next pointerï¼‰</span><br><span class="line">add    $0x8,%rax               # rax += 8ï¼ˆç§»åˆ°é™£åˆ—ä¸‹ä¸€å€‹æŒ‡æ¨™ï¼‰</span><br><span class="line">cmp    %rsi,%rax               # åˆ°çµå°¾äº†å—ï¼Ÿ</span><br><span class="line">je     0x4011d2                # æ˜¯ï¼ŒçµæŸ</span><br><span class="line">mov    %rdx,%rcx               # rcx = nextï¼ˆæº–å‚™ä¸‹æ¬¡è¿´åœˆï¼‰</span><br><span class="line">jmp    0x4011bd                # ç¹¼çºŒ</span><br></pre></td></tr></table></figure>
<p>æ”¶å°¾ (+222):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">movq   $0x0,0x8(%rdx)          # æœ€å¾Œä¸€å€‹ node-&gt;next = NULL</span><br></pre></td></tr></table></figure>
<p>é—œéµæŒ‡ä»¤è§£æï¼š</p>
<ul>
<li><code>mov (%rax),%rdx</code>ï¼šé–“æ¥å®šå€ï¼Œè®€å– <code>%rax</code> æŒ‡å‘çš„è¨˜æ†¶é«”å…§å®¹
<ul>
<li>ç­‰åŒæ–¼ C èªè¨€çš„ <code>*rax</code></li>
</ul>
</li>
<li><code>mov %rdx,0x8(%rcx)</code>ï¼šè¨­å®š next pointer
<ul>
<li>ç­‰åŒæ–¼ <code>current-&gt;next = next</code></li>
</ul>
</li>
</ul>
<h4 id="ç¬¬å…­æ®µï¼šæª¢æŸ¥éæ¸›é †åº-230-257">ç¬¬å…­æ®µï¼šæª¢æŸ¥éæ¸›é †åº (+230 ~ +257)</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mov    $0x5,%ebp               # ebp = 5ï¼ˆè¿´åœˆ 5 æ¬¡ï¼Œæª¢æŸ¥ 5 å°ç›¸é„°ç¯€é»ï¼‰</span><br><span class="line"></span><br><span class="line"># Loop:</span><br><span class="line">mov    0x8(%rbx),%rax          # rax = ä¸‹ä¸€å€‹ nodeï¼ˆrbx-&gt;nextï¼‰</span><br><span class="line">mov    (%rax),%eax             # eax = ä¸‹ä¸€å€‹ node çš„ value</span><br><span class="line">cmp    %eax,(%rbx)             # ç•¶å‰ value &gt;= ä¸‹ä¸€å€‹ value?</span><br><span class="line">jge    0x4011ee                # æ˜¯ï¼Œé€šé</span><br><span class="line">call   explode_bomb            # å¦ï¼Œçˆ†ç‚¸ï¼ˆå¿…é ˆéæ¸›ï¼ï¼‰</span><br><span class="line"></span><br><span class="line">mov    0x8(%rbx),%rbx          # rbx = rbx-&gt;nextï¼ˆç§»åˆ°ä¸‹ä¸€å€‹ nodeï¼‰</span><br><span class="line">sub    $0x1,%ebp               # è¨ˆæ•¸å™¨--</span><br><span class="line">jne    0x4011df                # ç¹¼çºŒè¿´åœˆ</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-è§£é¡Œæ­¥é©Ÿ-2">ğŸ¦€ è§£é¡Œæ­¥é©Ÿ</h3>
<ol>
<li>æŸ¥çœ‹ Linked List çš„å€¼</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/3xg 0x6032d0    # node1: value å’Œ next</span><br><span class="line">(gdb) x/3xg 0x6032e0    # node2</span><br><span class="line">(gdb) x/3xg 0x6032f0    # node3</span><br><span class="line">(gdb) x/3xg 0x603300    # node4</span><br><span class="line">(gdb) x/3xg 0x603310    # node5</span><br><span class="line">(gdb) x/3xg 0x603320    # node6</span><br></pre></td></tr></table></figure>
<p>ç¯„ä¾‹è¼¸å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node1: value = 332 (0x14c), next = 0x6032e0</span><br><span class="line">node2: value = 168 (0xa8),  next = 0x6032f0</span><br><span class="line">node3: value = 924 (0x39c), next = 0x603300</span><br><span class="line">node4: value = 691 (0x2b3), next = 0x603310</span><br><span class="line">node5: value = 477 (0x1dd), next = 0x603320</span><br><span class="line">node6: value = 443 (0x1bb), next = 0x000000</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æ‰¾å‡ºéæ¸›é †åº</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å€¼å¾å¤§åˆ°å°ï¼š924 &gt; 691 &gt; 477 &gt; 443 &gt; 332 &gt; 168</span><br><span class="line">å°æ‡‰ nodeï¼š  3     4     5     6     1     2</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>åæ¨è¼¸å…¥ï¼ˆè€ƒæ…® 7-x è½‰æ›ï¼‰</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¦å¾—åˆ° node3ï¼Œè¼¸å…¥ 7-3 = 4</span><br><span class="line">è¦å¾—åˆ° node4ï¼Œè¼¸å…¥ 7-4 = 3</span><br><span class="line">è¦å¾—åˆ° node5ï¼Œè¼¸å…¥ 7-5 = 2</span><br><span class="line">è¦å¾—åˆ° node6ï¼Œè¼¸å…¥ 7-6 = 1</span><br><span class="line">è¦å¾—åˆ° node1ï¼Œè¼¸å…¥ 7-1 = 6</span><br><span class="line">è¦å¾—åˆ° node2ï¼Œè¼¸å…¥ 7-2 = 5</span><br><span class="line"></span><br><span class="line">ç­”æ¡ˆï¼š4 3 2 1 6 5</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>é©—è­‰</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) break *0x4011ab    # é‡æ’å‰</span><br><span class="line">(gdb) break *0x4011df    # æª¢æŸ¥éæ¸›è¿´åœˆ</span><br><span class="line">(gdb) x/6xg 0x20($rsp)   # æª¢æŸ¥æŒ‡æ¨™é™£åˆ—é †åº</span><br><span class="line">(gdb) x/xw $rbx          # æª¢æŸ¥ç•¶å‰ node çš„ value</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-é‡è¦æ¦‚å¿µæ•´ç†">ğŸ¦€ é‡è¦æ¦‚å¿µæ•´ç†</h3>
<h4 id="1-é™£åˆ—-vs-Linked-List-çš„è¾¨è­˜">1. é™£åˆ— vs Linked List çš„è¾¨è­˜</h4>
<p>é™£åˆ—ç‰¹å¾µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov %rdx, 0x20(%rsp,%rsi,2)    # base + index Ã— scale</span><br><span class="line">add $0x4, %rsi                 # å›ºå®šé–“éš”éå¢</span><br></pre></td></tr></table></figure>
<ul>
<li>é€£çºŒå®šå€ï¼š<code>base + offset</code></li>
<li>è¦å¾‹å­˜å–</li>
<li>é€šå¸¸åœ¨ stack ä¸Š</li>
</ul>
<p>Linked List ç‰¹å¾µï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov 0x8(%rdx),%rdx             # é€é next pointer</span><br></pre></td></tr></table></figure>
<ul>
<li>é€é offset <code>0x8</code> è·³è½‰ï¼ˆnext pointerï¼‰</li>
<li>ä¸è¦å¾‹ä½å€</li>
<li>é€šå¸¸åœ¨éœæ…‹è¨˜æ†¶é«”ï¼ˆå›ºå®šä½å€å¦‚ <code>0x6032d0</code>ï¼‰</li>
</ul>
<h4 id="2-é–“æ¥å®šå€-Dereference">2. é–“æ¥å®šå€ (Dereference)</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov (%rax),%eax</span><br></pre></td></tr></table></figure>
<ul>
<li>è®€å– <code>%rax</code> <strong>æŒ‡å‘çš„è¨˜æ†¶é«”å…§å®¹</strong></li>
<li>ç­‰åŒæ–¼ C èªè¨€çš„ <code>*rax</code></li>
</ul>
<p>ç¯„ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å‡è¨­ %rax = 0x6032d0</span><br><span class="line">è¨˜æ†¶é«” 0x6032d0 å­˜çš„å€¼æ˜¯ 332</span><br><span class="line"></span><br><span class="line">mov (%rax),%eax  â†’ %eax = 332</span><br></pre></td></tr></table></figure>
<h4 id="3-16-é€²ä½è¨ˆç®—">3. 16 é€²ä½è¨ˆç®—</h4>
<p>çµ„èªä¸­æ‰€æœ‰ <code>0x</code> é–‹é ­çš„æ•¸å­—éƒ½æ˜¯ 16 é€²ä½ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x20 + 8 = 0x28  ï¼ˆä¸æ˜¯ 28ï¼‰</span><br><span class="line">0x28 + 8 = 0x30  ï¼ˆä¸æ˜¯ 36ï¼‰</span><br><span class="line">0x30 + 8 = 0x38</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>GDB å°æŠ€å·§ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p/x 0x28 + 8</span><br><span class="line">$1 = 0x30</span><br></pre></td></tr></table></figure>
<h4 id="4-Stack-Canaryï¼ˆå¯å¿½ç•¥ï¼‰">4. Stack Canaryï¼ˆå¯å¿½ç•¥ï¼‰</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mov    %fs:0x28,%rax           # è®€ canary</span><br><span class="line">mov    %rax,0x18(%rsp)         # å­˜åˆ° stack</span><br><span class="line">...</span><br><span class="line">xor    %fs:0x28,%rax           # æª¢æŸ¥</span><br><span class="line">je     æ­£å¸¸è¿”å›</span><br><span class="line">call   __stack_chk_fail        # canary è¢«æ”¹ â†’ çˆ†ç‚¸</span><br></pre></td></tr></table></figure>
<ul>
<li>é˜²æ­¢ buffer overflow</li>
<li>è§£é¡Œæ™‚å¯å¿½ç•¥</li>
</ul>
<h3 id="ğŸ¦€-GDB-é™¤éŒ¯æŠ€å·§">ğŸ¦€ GDB é™¤éŒ¯æŠ€å·§</h3>
<ol>
<li>è¨­å®šå¤šå€‹ breakpoint è·³éå·²çŸ¥æ®µè½</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) break *0x401153    # è½‰æ› 7-x å‰</span><br><span class="line">(gdb) break *0x4011ab    # é‡æ’ linked list å‰</span><br><span class="line">(gdb) break *0x4011df    # æª¢æŸ¥éæ¸›å‰</span><br><span class="line">(gdb) continue           # è·³åˆ°ä¸‹å€‹ breakpoint</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æŸ¥çœ‹è¨˜æ†¶é«”å…§å®¹</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/6wd $rsp         # çœ‹è¼¸å…¥é™£åˆ—ï¼ˆ6 å€‹ wordï¼Œdecimalï¼‰</span><br><span class="line">(gdb) x/6xg 0x20($rsp)   # çœ‹æŒ‡æ¨™é™£åˆ—ï¼ˆ6 å€‹ 8-byteï¼Œhexï¼‰</span><br><span class="line">(gdb) x/3xg 0x6032d0     # çœ‹ node çµæ§‹</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>å„²å­˜ breakpoints</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) save breakpoints phase6.bp</span><br><span class="line">(gdb) source phase6.bp   # ä¸‹æ¬¡è¼‰å…¥</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>è¨­å®š convenience variable</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) set $node1 = 0x6032d0</span><br><span class="line">(gdb) x/3xg $node1</span><br></pre></td></tr></table></figure>
<h3 id="ğŸ¦€-æ–°å­¸åˆ°çš„æŒ‡ä»¤-2">ğŸ¦€ æ–°å­¸åˆ°çš„æŒ‡ä»¤</h3>
<ol>
<li>
<p><code>movzbl src, dst</code></p>
<ul>
<li>Move zero-extend byte to long</li>
<li>è®€ 1 byteï¼Œæ”¾é€² 32-bit æš«å­˜å™¨ï¼Œé«˜ä½è£œ 0</li>
</ul>
</li>
<li>
<p><code>movslq src, dst</code></p>
<ul>
<li>Move sign-extend long to quad</li>
<li>å¸¶ç¬¦è™Ÿæ“´å±•ï¼š32-bit â†’ 64-bit</li>
</ul>
</li>
<li>
<p><code>lea addr, dst</code></p>
<ul>
<li>Load effective address</li>
<li>è¨ˆç®—ä½å€ä½†ä¸è®€å–è¨˜æ†¶é«”</li>
<li>å¸¸ç”¨æ–¼æŒ‡æ¨™é‹ç®—</li>
</ul>
</li>
<li>
<p>å®šå€æ¨¡å¼ï¼š<code>offset(%base, %index, scale)</code></p>
<ul>
<li>è¨ˆç®—ï¼š<code>base + offset + index Ã— scale</code></li>
<li>ç¯„ä¾‹ï¼š
<ul>
<li><code>0x20(%rsp,%rsi,2)</code> = <code>rsp + 0x20 + rsi Ã— 2</code></li>
<li><code>(%rsp,%rax,4)</code> = <code>rsp + rax Ã— 4</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="ğŸ¦€-å°çµ">ğŸ¦€ å°çµ</h3>
<p>Phase 6 çš„é›£é»ï¼š</p>
<ol>
<li>ç¨‹å¼ç¢¼å¾ˆé•·ï¼ˆ~110 è¡Œï¼‰</li>
<li>å¤šå±¤è¿´åœˆåµŒå¥—</li>
<li>éœ€è¦ç†è§£ linked list è³‡æ–™çµæ§‹</li>
<li>æ¶‰åŠæŒ‡æ¨™æ“ä½œå’Œé–“æ¥å®šå€</li>
<li>éœ€è¦é€†å‘æ¨ç†ï¼ˆå¾çµæœåæ¨è¼¸å…¥ï¼‰</li>
</ol>
<p>è§£é¡Œé—œéµï¼š</p>
<ol>
<li>åˆ†æ®µç†è§£ï¼šä¸è¦ä¸€æ¬¡çœ‹å®Œï¼Œæ¨™è¨˜æ¯æ®µåŠŸèƒ½</li>
<li>è¿½è¹¤æš«å­˜å™¨ï¼šäº†è§£æ¯å€‹æš«å­˜å™¨çš„ç”¨é€”</li>
<li>å–„ç”¨ GDBï¼šå¯¦éš›åŸ·è¡Œæ¯”å…‰çœ‹ç¨‹å¼ç¢¼æ›´æ¸…æ¥š</li>
<li>ç•«åœ–è¼”åŠ©ï¼šç•«å‡º linked list çµæ§‹å’Œè½‰æ›éç¨‹</li>
<li>è€å¿ƒé™¤éŒ¯ï¼šæ…¢æ…¢è¿½è¹¤ï¼Œä¸€æ­¥æ­¥é©—è­‰</li>
</ol>
<h2 id="ğŸ³-Reference">ğŸ³ Reference</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://csapp.cs.cmu.edu/3e/labs.html">https://csapp.cs.cmu.edu/3e/labs.html</a></li>
<li><a target="_blank" rel="noopener" href="https://web.stanford.edu/class/cs107/resources/x86-64-reference.pdf">https://web.stanford.edu/class/cs107/resources/x86-64-reference.pdf</a></li>
</ul>
<hr>
<div class="success">
<p>ğŸ’¡ æœ¬ç­†è¨˜ç¶“èˆ‡ Claude (Anthropic) è¨è«–æ•´ç†è€Œæˆï¼ŒåŒ…å«çµ„èªæŒ‡ä»¤è§£æã€GDB æ“ä½œæŠ€å·§èˆ‡é™¤éŒ¯æ€è·¯ã€‚</p>
</div>
</div></article></div></main><footer><div class="paginator"><a class="next" href="/from-zero-to-bug-hunter-my-lkmp-journey/">NEXT</a></div><div class="copyright"><p>Â© 2021 - 2025 <a href="https://simonecheng.github.io">Simone Cheng</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/achjqz/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script type="text/javascript" id="maid-script" src="https://unpkg.com/mermaid@10.3.1/dist/mermaid.min.js?v=undefined"></script><script>if (window.mermaid) {
  var options = JSON.parse(document.getElementById('maid-script').getAttribute('mermaidoptioins'));
  mermaid.initialize(options);
}
</script><script>const tocTitleElement = document.querySelector('.toc-title');
const tocContentElement = document.querySelector('.toc-content');
if (tocTitleElement) {
  tocTitleElement.addEventListener('click', (e) => {
    const isActive = tocContentElement.classList.contains('active') || tocTitleElement.classList.contains('active');
    if (isActive) {
      tocContentElement.classList.remove('active');
      tocTitleElement.classList.remove('active');
    } else {
      tocContentElement.classList.add('active');
      tocTitleElement.classList.add('active');
    }
  });
}</script></body></html>